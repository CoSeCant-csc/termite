var CoreModel=Backbone.Model.extend();CoreModel.prototype.triggerDirty=function(){this.trigger("dirty",this.__dirty__||{});delete this.__dirty__};CoreModel.prototype.__combineDirty__=function(a,b){if(!0===a||!0===b)return!0;for(key in b)if(Array.isArray(key))for(var c=0;c<key.length;c++)a[key[c]]=this.__combineDirty(a[key[c]]||{},b[key[c]]);else a[key]=this.__combineDirty__(a[key]||{},b[key]);return a};
CoreModel.prototype.combineDirty=function(a){this.__dirty__=this.__combineDirty__(this.__dirty__||{},a)};CoreModel.prototype.__setDirty__=function(a,b,c){if(!0===a||c>=b.length)return!0;var d=b[c];if(Array.isArray(d))for(var e=0;e<d.length;e++)a[d[e]]=this.__setDirty__(a[d[e]]||{},b,c+1);else a[d]=this.__setDirty__(a[d]||{},b,c+1);return a};CoreModel.prototype.setDirty=function(){var a=Array.prototype.slice.call(arguments);this.__dirty__=this.__setDirty__(this.__dirty__||{},a,0)};
CoreModel.prototype.__isDirty__=function(a,b,c){if(!0===a||c>=b.length)return!0;var d=b[c];if(Array.isArray(d))for(var e=0;e<d.length;e++){if(a.hasOwnProperty(d[e])&&this.__isDirty__(a[d[e]],b,c+1))return!0}else if(a.hasOwnProperty(d)&&this.__isDirty__(a[d],b,c+1))return!0;return!1};CoreModel.prototype.isDirty=function(){var a=Array.prototype.slice.call(arguments);return this.hasOwnProperty("__dirty__")?this.__isDirty__(this.__dirty__,a,0):!1};
CoreModel.prototype.__getDirty__=function(a,b,c){if(!0===a||c>=b.length)return a;var d=b[c];if(Array.isArray(d)){for(var e={},f=0;f<d.length;f++)a.hasOwnProperty(d[f])?e[d[f]]=this.__getDirty__(a[d[f]],b,c+1):e[d[f]]=void 0;return e}if(a.hasOwnProperty(d))return this.__getDirty__(a[d],b,c+1)};CoreModel.prototype.getDirty=function(){var a=Array.prototype.slice.call(arguments);if(this.hasOwnProperty("__dirty__"))return this.__getDirty__(this.__dirty__,a,0)};
CoreModel.prototype.__setAttribute__=function(a,b,c,d){var e=b[c];if(Array.isArray(e))for(var f=0;f<e.length;f++)c+1>=b.length?void 0===d?delete a[e[f]]:a[e[f]]=d:a.hasOwnProperty(e[f])?a[e[f]]=this.__setAttribute__(a[e[f]],b,c+1,d):a[e[f]]=this.__setAttribute__({},b,c+1,d);else c+1>=b.length?void 0===d?delete a[e]:a[e]=d:a.hasOwnProperty(e)?a[e]=this.__setAttribute__(a[e],b,c+1,d):a[e]=this.__setAttribute__({},b,c+1,d);return a};
CoreModel.prototype.setAttribute=function(){var a=Array.prototype.slice.call(arguments),b=a.pop(),c=a[0];if(Array.isArray(c))for(var d=0;d<c.length;d++)1>=a.length?void 0===b?this.unset(c[d],{silent:!0}):this.set(c[d],b,{silent:!0}):this.set(c[d],this.__setAttribute__(this.get(c[d])||{},a,1,b),{silent:!0});else 1>=a.length?void 0===b?this.unset(c,{silent:!0}):this.set(c,b,{silent:!0}):this.set(c,this.__setAttribute__(this.get(c)||{},a,1,b),{silent:!0});return this};
CoreModel.prototype.__hasAttribute__=function(a,b,c){var d=b[c];if(Array.isArray(d))for(var e=0;e<d.length;e++){if(!a.hasOwnProperty(d[e])||c+1<b.length&&!this.__hasAttribute__(a[d[e]],b,c+1))return!1}else if(!a.hasOwnProperty(d)||c+1<b.length&&!this.__hasAttribute__(a[d],b,c+1))return!1;return!0};
CoreModel.prototype.hasAttribute=function(){var a=Array.prototype.slice.call(arguments),b=a[0];if(Array.isArray(b))for(var c=0;c<b.length;c++){if(!this.has(b[c])||1<a.length&&!this.__hasAttribute__(this.get(b[c]),a,1))return!1}else if(!this.has(b)||1<a.length&&!this.__hasAttribute__(this.get(b),a,1))return!1;return!0};
CoreModel.prototype.__getAttribute__=function(a,b,c){var d=b[c];if(Array.isArray(d)){for(var e={},f=0;f<d.length;f++)c+1>=b.length?a.hasOwnProperty(d[f])?e[d[f]]=a[d[f]]:e[d[f]]=void 0:a.hasOwnProperty(d[f])?e[d[f]]=this.__getAttribute__(a[d[f]],b,c+1):e[d[f]]=void 0;return e}if(c+1>=b.length){if(a.hasOwnProperty(d))return a[d]}else if(a.hasOwnProperty(d))return this.__getAttribute__(a[d],b,c+1)};
CoreModel.prototype.getAttribute=function(){var a=Array.prototype.slice.call(arguments),b=a[0];if(Array.isArray(b)){for(var c={},d=0;d<b.length;d++)1>=a.length?this.has(b[d])?c[b[d]]=this.get(b[d]):c[b[d]]=void 0:this.has(b[d])?c[b[d]]=this.__getAttribute__(this.get(b[d]),a,1):c[b[d]]=void 0;return c}if(1>=a.length){if(this.has(b))return this.get(b)}else if(this.has(b))return this.__getAttribute__(this.get(b),a,1)};var CoreView=Backbone.View.extend();CoreView.prototype.initialize=function(){this.__dirty__=!1};CoreView.prototype.triggerDirty=CoreModel.prototype.triggerDirty;CoreView.prototype.__isDirty__=CoreModel.prototype.__isDirty__;CoreView.prototype.isDirty=CoreModel.prototype.isDirty;CoreView.prototype.__combineDirty__=CoreModel.prototype.__combineDirty__;CoreView.prototype.combineDirty=CoreModel.prototype.combineDirty;CoreView.prototype.__setDirty__=CoreModel.prototype.__setDirty__;
CoreView.prototype.setDirty=CoreModel.prototype.setDirty;CoreView.prototype.__getDirty__=CoreModel.prototype.__getDirty__;CoreView.prototype.getDirty=CoreModel.prototype.getDirty;CoreView.prototype.__eventType=function(a){if(d3.event.ctrlKey||d3.event.metaKey)a+="+meta";d3.event.altKey&&(a+="+alt");d3.event.shiftKey&&(a+="+shift");return a};
CoreView.prototype.__keyDownHandler=function(a){var b=this.__eventType("keydown"),c="fired:"+b+":"+eventParams;this.trigger(c,{event:d3.event,eventID:c,eventType:b,eventParams:eventParams,data:a,element:d3.event.srcElement})};CoreView.prototype.__keyPressHandler=function(a){var b=this.__eventType("keypress"),c="fired:"+b+":"+eventParams;this.trigger(c,{event:d3.event,eventID:c,eventType:b,eventParams:eventParams,data:a,element:d3.event.srcElement})};
CoreView.prototype.__keyUpHandler=function(a){var b=this.__eventType("keyup"),c="fired:"+b+":"+eventParams;this.trigger(c,{event:d3.event,eventID:c,eventType:b,eventParams:eventParams,data:a,element:d3.event.srcElement})};CoreView.prototype.__mouseClickHandler=function(a){var b=this.__eventType("click"),c=a.dataType,d="fired:"+b+":"+c;this.trigger(d,{event:d3.event,eventID:d,eventType:b,eventParams:c,data:a,element:d3.event.srcElement});d3.event.cancelBubble=!0;d3.event.preventDefault()};
CoreView.prototype.__mouseOverHandler=function(a){var b=this.__eventType("enter"),c=a.dataType,d="fired:"+b+":"+c;this.trigger(d,{event:d3.event,eventID:d,eventType:b,eventParams:c,data:a,element:d3.event.srcElement})};CoreView.prototype.__mouseOutHandler=function(a){var b=this.__eventType("exit"),c=a.dataType,d="fired:"+b+":"+c;this.trigger(d,{event:d3.event,eventID:d,eventType:b,eventParams:c,data:a,element:d3.event.srcElement})};
CoreView.prototype.__dragStartHandler=function(a){if(!0!==this.model.get("ui:dragActive")){d3.event.dataTransfer.effectAllowed="move";d3.event.dataTransfer.setDragImage(document.createElement("div"),0,0);var b=this.__eventType("dragstart"),c=a.dataType,d="fired:"+b+":"+c,e=d3.event.srcElement;this.model.set({"ui:dragActive":!0,"ui:dragData":a,"ui:dragElement":e});this.trigger(d,{event:d3.event,eventID:d,eventType:b,eventParams:c,data:a,element:e})}};
CoreView.prototype.__dragEndHandler=function(a){var b=this.__eventType("dragend"),c=a.dataType,d="fired:"+b+":"+c;this.trigger(d,{event:d3.event,eventID:d,eventType:b,eventParams:c,data:a,element:d3.event.srcElement});this.model.set({"ui:dragActive":!1,"ui:dragData":null,"ui:dragElement":null})};
CoreView.prototype.__dragEnterHandler=function(a){if(!0===this.model.get("ui:dragActive")){var b=this.__eventType("dragenter"),c=this.model.get("ui:dragData"),d=c.dataType+":"+a.dataType,e="fired:"+b+":"+d,f=this.model.get("ui:dragElement"),h=d3.event.srcElement;this.trigger(e,{event:d3.event,eventID:e,eventType:b,eventParams:d,data:a,element:h,sourceData:c,sourceElement:f,targetData:a,targetElement:h})}};
CoreView.prototype.__dragOverHandler=function(a){if(!0===this.model.get("ui:dragActive")){d3.event.preventDefault&&d3.event.preventDefault();d3.event.dataTransfer.dropEffect="move";var b=this.__eventType("dragover"),c=this.model.get("ui:dragData"),d=c.dataType+":"+a.dataType,e="fired:"+b+":"+d,f=this.model.get("ui:dragElement"),h=d3.event.srcElement;this.trigger(e,{event:d3.event,eventID:e,eventType:b,eventParams:d,data:a,element:h,sourceData:c,sourceElement:f,targetData:a,targetElement:h})}};
CoreView.prototype.__dragLeaveHandler=function(a){if(!0===this.model.get("ui:dragActive")){var b=this.__eventType("dragleave"),c=this.model.get("ui:dragData"),d=c.dataType+":"+a.dataType,e="fired:"+b+":"+d,f=this.model.get("ui:dragElement"),h=d3.event.srcElement;this.trigger(e,{event:d3.event,eventID:e,eventType:b,eventParams:d,data:a,element:h,sourceData:c,sourceElement:f,targetData:a,targetElement:h})}};
CoreView.prototype.__dropHandler=function(a){if(!0===this.model.get("ui:dragActive")){var b=this.__eventType("dragdrop"),c=this.model.get("ui:dragData"),d=c.dataType+":"+a.dataType,e="fired:"+b+":"+d,f=this.model.get("ui:dragElement"),h=d3.event.srcElement;this.trigger(e,{event:d3.event,eventID:e,eventType:b,eventParams:d,data:a,element:h,sourceData:c,sourceElement:f,targetData:a,targetElement:h})}};
CoreView.prototype.keystrokeListeners=function(a){a.on("keydown",this.__keyDownHandler.bind(this)).on("keypress",this.__keyPressHandler.bind(this)).on("keyup",this.__keyUpHandler.bind(this))};CoreView.prototype.mouseListeners=function(a){a.style("pointer-events","auto").on("click",this.__mouseClickHandler.bind(this)).on("mouseover",this.__mouseOverHandler.bind(this)).on("mouseout",this.__mouseOutHandler.bind(this))};
CoreView.prototype.dragdropListeners=function(a){a.style("pointer-events","auto").attr("draggable",!0).on("dragstart",this.__dragStartHandler.bind(this)).on("dragend",this.__dragEndHandler.bind(this)).on("dragover",this.__dragOverHandler.bind(this)).on("dragenter",this.__dragEnterHandler.bind(this)).on("dragleave",this.__dragLeaveHandler.bind(this)).on("drop",this.__dropHandler.bind(this))};var MatrixState=CoreModel.extend({defaults:{version:"termite-2.0.10",dataID:void 0}});MatrixState.prototype.initialize=function(a){this.__initUpdates()};
MatrixState.prototype.CONST={ROW_PREFIX:"Row",COLUMN_PREFIX:"Column",MIN_VISIBLE_ROW_QUANTILE:0,MAX_VISIBLE_ROW_QUANTILE:80,MIN_VISIBLE_ROW_COUNT:0,MAX_VISIBLE_ROW_COUNT:200,MIN_ORDERED_ROW_QUANTILE:0,MAX_ORDERED_ROW_QUANTILE:60,MIN_ORDERED_ROW_COUNT:0,MAX_ORDERED_ROW_COUNT:150,SELECTION_COUNT:8,SELECTION_PREFIX:"Selection",SELECTION_LABELS:"Blue topics;Orange topics;Green topics;Purple topics;Brown topics;Pink topics;Yellow topics;Aqua topics".split(";"),SELECTION_COLORS:"#1f77b4 #ff7f0e #2ca02c #9467bd #8c564b #e377c2 #bcbd22 #17becf".split(" "),
SELECTION_BACKGROUNDS:"#aec7e8 #ffbb78 #98df8a #c5b0d5 #c49c94 #f7b6d2 #dbdb8d #9edae5".split(" ")};
MatrixState.prototype.__resetParameters=function(){var a=this.__data__.rowDims,b=this.__data__.columnDims,c=this.CONST.SELECTION_COUNT;this.__reset({normalization:"none",rowInExclusions:{},rowUserDefinedVisibilities:{},columnInExclusions:{},columnUserDefinedVisibilities:{},globalVisibleRowCount:25,columnVisibleRowCounts:{},selectionVisibleRowCounts:{},expansionVisibleRowCount:0,globalVisibleRowQuantile:0,columnVisibleRowQuantiles:{},selectionVisibleRowQuantiles:{},expansionVisibleRowQuantile:10,rowOrderingType:"auto",
rowCurrentOrdering:null,rowUserDefinedOrdering:_.range(a),columnOrderingType:"auto",columnCurrentOrdering:null,columnUserDefinedOrdering:_.range(b),rowAutoOrderingBaseList:_.range(a),globalOrderedRowCount:0,columnOrderedRowCounts:{},selectionOrderedRowCounts:{},expansionOrderedRowCount:0,globalOrderedRowQuantile:0,columnOrderedRowQuantiles:{},selectionOrderedRowQuantiles:{},expansionOrderedRowQuantile:10,rowHighlights:{},columnHighlights:{},entryHighlights:{},rowExpansiosn:{},columnExpansions:{},
rowSelections:{},columnSelections:{},entryProDemotions:{},selectionCount:c,selectionLabels:this.CONST.SELECTION_LABELS.slice(0,c),selectionColors:this.CONST.SELECTION_COLORS.slice(0,c),selectionBackgrounds:this.CONST.SELECTION_BACKGROUNDS.slice(0,c),rankingThreshold:1E-4,highlightThreshold:5E-4})};
MatrixState.prototype.setParameters=function(a){this.setDirty();this.__resetParameters();for(var b in a)this.has(b)&&("rowLabels"===b||"columnLabels"===b?0<a[b].length&&this.set(b,a[b]):this.set(b,a[b]));this.set({rowHighlights:{},columnHighlights:{},entryHighlights:{},rowExpansiosn:{},columnExpansions:{}});return this};
MatrixState.prototype.getParameters=function(){var a="dataID sparseMatrix rowDims columnDims rowAdmissions columnAdmissions".split(" "),b={},c;for(c in matrixState.attributes)-1===a.indexOf(c)&&(b[c]=matrixState.get(c));return b};MatrixState.prototype.__initUpdates=function(){this.__triggerDirty=_.debounce(this.triggerDirty,20)};
MatrixState.prototype.setAttributeAndDirty=function(){var a=Array.prototype.slice.call(arguments,0,arguments.length-1);CoreModel.prototype.setAttribute.apply(this,arguments);CoreModel.prototype.setDirty.apply(this,a);this.__triggerDirty()};MatrixState.prototype.__reset=function(a){for(var b in a)CoreModel.prototype.setAttribute.call(this,b,a[b]),CoreModel.prototype.setDirty.call(this,b);this.__triggerDirty()};
MatrixState.prototype.importEntries=function(a,b,c,d,e,f){void 0===c&&(c=_.max(b.map(function(a){return a.rowIndex}))+1);void 0===d&&(d=_.max(b.map(function(a){return a.columnIndex}))+1);void 0===e&&(e=_.range(c).map(function(a){return!1}));void 0===f&&(f=_.range(d).map(function(a){return!0}));for(var h=[],g=0;g<b.length;g++){var k=b[g],l=k.rowIndex,m=k.columnIndex;0<k.value&&0<=l&&l<c&&0<=m&&m<d&&h.push(k)}this.__importMatrix(a,c,d,h,e,f);return this};
MatrixState.prototype.importMatrix=function(a,b,c,d,e,f){void 0===c&&(c=b.length);void 0===d&&(d=Math.apply.max(Math,b.map(function(a){return a.length})));void 0===e&&(e=_.range(c).map(function(a){return!1}));void 0===f&&(f=_.range(d).map(function(a){return!0}));for(var h=[],g=Math.min(c,b.length),k=0;k<g;k++)for(var l=Math.min(d,b[k].length),m=0;m<l;m++)0<b[k][m]&&h.push({rowIndex:k,columnIndex:m,value:b[k][m]});this.__importMatrix(a,c,d,h,e,f);return this};
MatrixState.prototype.__importMatrix=function(a,b,c,d,e,f){this.setDirty();this.setAttributeAndDirty("dataID",a);this.__data__={rowDims:b,columnDims:c,rowAdmissions:e,columnAdmissions:f,sparseMatrix:d};this.__resetParameters()};MatrixState.prototype.normalization=function(a){a=a.trim().toLowerCase();"row"!==a&&"column"!==a&&"none"!==a||this.getAttribute("normalization")===a||this.setAttributeAndDirty("normalization",a);return this};
MatrixState.prototype.rowInclusionsAndExclusions=function(a,b){0<=a&&a<this.__data__.rowDims&&(!0!==b&&!1!==b&&void 0!==b||this.getAttribute("rowInExclusions",a)===b||this.setAttributeAndDirty("rowInExclusions",a,b));return this};MatrixState.prototype.rowUserDefinedVisibilities=function(a,b){0<=a&&a<this.__data__.rowDims&&(!0!==b&&!1!==b&&void 0!==b||this.getAttribute("rowUserDefinedVisibilities",a)===b||this.setAttributeAndDirty("rowUserDefinedVisibilities",a,b));return this};
MatrixState.prototype.globalVisibleRowCount=function(a){this.CONST.MIN_VISIBLE_ROW_COUNT<=a&&a<=this.CONST.MAX_VISIBLE_ROW_COUNT&&this.getAttribute("globalVisibleRowCount")!==a&&this.setAttributeAndDirty("globalVisibleRowCount",a);return this};MatrixState.prototype.columnVisibleRowCounts=function(a,b){0<=a&&a<this.__data__.columnDims&&0<=b&&this.getAttribute("columnVisibleRowCounts",a)!==b&&this.setAttributeAndDirty("columnVisibleRowCounts",a,b);return this};
MatrixState.prototype.selectionVisibleRowCounts=function(a,b){0<=a&&a<this.get("selectionCount")&&0<=b&&this.getAttribute("selectionVisibleRowCounts",a)!==b&&this.setAttributeAndDirty("selectionVisibleRowCounts",a,b);return this};MatrixState.prototype.globalVisibleRowQuantile=function(a){0<=a&&100>=a&&this.getAttribute("globalVisibleRowQuantiles")!==a&&this.setAttributeAndDirty("globalVisibleRowQuantiles",a);return this};
MatrixState.prototype.columnVisibleRowQuantiles=function(a,b){0<=a&&a<this.__data__.columnDims&&0<=b&&this.getAttribute("columnVisibleRowQuantiles",a)!==b&&this.setAttributeAndDirty("columnVisibleRowQuantiles",a,b);return this};MatrixState.prototype.selectionVisibleRowQuantiles=function(a,b){0<=a&&a<this.get("selectionCount")&&0<=b&&this.getAttribute("selectionVisibleRowQuantiles",a)!==b&&this.setAttributeAndDirty("selectionVisibleRowQuantiles",a,b);return this};
MatrixState.prototype.rowAutoOrdering=function(a){"auto"!==this.getAttribute("rowOrderingType")&&(this.setAttributeAndDirty("rowOrderingType","auto"),void 0===a&&(a=this.getAttribute("rowCurrentOrdering")),a=this.__sanitizeOrdering(this.__data__.rowDims,a),this.setAttributeAndDirty("rowAutoOrderingBaseList",a),this.setAttributeAndDirty("globalOrderedRowCount",0),this.setAttributeAndDirty("columnOrderedRowCounts",{}),this.setAttributeAndDirty("selectionOrderedRowCounts",{}),this.setAttributeAndDirty("globalOrderedRowQuantile",
0),this.setAttributeAndDirty("columnOrderedRowQuantiles",{}),this.setAttributeAndDirty("selectionOrderedRowQuantiles",{}));return this};MatrixState.prototype.globalOrderedRowCount=function(a){this.rowAutoOrdering();this.CONST.MIN_ORDERED_ROW_COUNT<=a&&a<=this.CONST.MAX_ORDERED_ROW_COUNT&&this.getAttribute("globalOrderedRowCount")!==a&&this.setAttributeAndDirty("globalOrderedRowCount",a);return this};
MatrixState.prototype.columnOrderedRowCounts=function(a,b){this.rowAutoOrdering();0<=a&&a<this.__data__.columnDims&&this.CONST.MIN_ORDERED_ROW_COUNT<=b&&b<=this.CONST.MAX_ORDERED_ROW_COUNT&&this.getAttribute("columnOrderedRowCounts",a)!==b&&this.setAttributeAndDirty("columnOrderedRowCounts",a,b);return this};
MatrixState.prototype.selectionOrderedRowCounts=function(a,b){this.rowAutoOrdering();0<=a&&a<this.get("selectionCount")&&this.CONST.MIN_ORDERED_ROW_COUNT<=b&&b<=this.CONST.MAX_ORDERED_ROW_COUNT&&this.getAttribute("selectionOrderedRowCounts",a)!==b&&this.setAttributeAndDirty("selectionOrderedRowCounts",a,b);return this};
MatrixState.prototype.globalOrderedRowQuantile=function(a){this.rowAutoOrdering();0<=a&&100>=a&&this.getAttribute("globalOrderedRowQuantiles")!==a&&this.setAttributeAndDirty("globalOrderedRowQuantiles",a);return this};MatrixState.prototype.columnOrderedRowQuantiles=function(a,b){this.rowAutoOrdering();0<=a&&a<this.__data__.columnDims&&0<=b&&100>=b&&this.getAttribute("columnOrderedRowQuantiles",a)!==b&&this.setAttributeAndDirty("columnOrderedRowQuantiles",a,b);return this};
MatrixState.prototype.selectionOrderedRowQuantiles=function(a,b){this.rowAutoOrdering();0<=a&&a<this.get("selectionCount")&&0<=b&&100>=b&&this.getAttribute("selectionOrderedRowQuantiles",a)!==b&&this.setAttributeAndDirty("selectionOrderedRowQuantiles",a,b);return this};
MatrixState.prototype.rowUserDefinedOrdering=function(a){"user"!==this.getAttribute("rowOrderingType")&&this.setAttributeAndDirty("rowOrderingType","user");a=this.__sanitizeOrdering(this.__data__.rowDims,a);this.setAttributeAndDirty("rowUserDefinedOrdering",a);return this};
MatrixState.prototype.columnUserDefinedOrdering=function(a){"user"!==this.getAttribute("columnOrderingType")&&this.setAttributeAndDirty("columnOrderingType","user");a=this.__sanitizeOrdering(this.__data__.columnDims,a);this.setAttributeAndDirty("columnUserDefinedOrdering",a);return this};MatrixState.prototype.__sanitizeOrdering=function(a,b){for(var c=[],d={},e=0;e<b.length;e++){var f=b[e];0<=f&&f<a&&!d.hasOwnProperty(f)&&(c.push(f),d[f]=!0)}for(f=0;f<a;f++)d.hasOwnProperty(f)||c.push(f);return c};
MatrixState.prototype.moveRowAfter=function(a,b){var c=this.__data__.rowDims;if(0<=a&&a<c&&0<=b&&b<c){var d=this.get("rowCurrentOrdering"),c=this.__getMoveAfterOrdering(c,d,a,b);this.rowUserDefinedOrdering(c)}return this};MatrixState.prototype.moveRowBefore=function(a,b){var c=this.__data__.rowDims;if(0<=a&&a<c&&0<=b&&b<c){var d=this.get("rowCurrentOrdering"),c=this.__getMoveBeforeOrdering(c,d,a,b);this.rowUserDefinedOrdering(c)}return this};
MatrixState.prototype.moveColumnAfter=function(a,b){var c=this.__data__.columnDims;if(0<=a&&a<c&&0<=b&&b<c){var d=this.get("columnCurrentOrdering"),c=this.__getMoveAfterOrdering(c,d,a,b);this.columnUserDefinedOrdering(c)}return this};MatrixState.prototype.moveColumnBefore=function(a,b){var c=this.__data__.columnDims;if(0<=a&&a<c&&0<=b&&b<c){var d=this.get("columnCurrentOrdering"),c=this.__getMoveBeforeOrdering(c,d,a,b);this.columnUserDefinedOrdering(c)}return this};
MatrixState.prototype.__getMoveAfterOrdering=function(a,b,c,d){a=b.indexOf(c);b=b.slice(0,a).concat(b.slice(a+1));d=b.indexOf(d);b.splice(d+1,0,c);return b};MatrixState.prototype.__getMoveBeforeOrdering=function(a,b,c,d){a=b.indexOf(c);b=b.slice(0,a).concat(b.slice(a+1));d=b.indexOf(d);b.splice(d,0,c);return b};
MatrixState.prototype.rowHighlights=function(a){if(0<=a&&a<this.__data__.rowDims&&!0!==this.getAttribute("rowHighlights",a)){for(var b in this.get("rowHighlights"))this.setAttributeAndDirty("rowHighlights",b,void 0);for(var c in this.get("columnHighlights"))this.setAttributeAndDirty("columnHighlights",c,void 0);for(var d in this.get("entryHighlights"))this.setAttributeAndDirty("entryHighlights",d,void 0);this.setAttributeAndDirty("rowHighlights",a,!0)}return this};
MatrixState.prototype.columnHighlights=function(a){if(0<=a&&a<this.__data__.columnDims&&!0!==this.getAttribute("columnHighlights",a)){for(var b in this.get("rowHighlights"))this.setAttributeAndDirty("rowHighlights",b,void 0);for(var c in this.get("columnHighlights"))this.setAttributeAndDirty("columnHighlights",c,void 0);for(var d in this.get("entryHighlights"))this.setAttributeAndDirty("entryHighlights",d,void 0);this.setAttributeAndDirty("columnHighlights",a,!0)}return this};
MatrixState.prototype.entryHighlights=function(a,b){var c=a+":"+b;if(0<=a&&a<this.__data__.rowDims&&0<=b&&b<this.__data__.columnDims&&!0!==this.getAttribute("entryHighlights",c)){for(var d in this.get("rowHighlights"))this.setAttributeAndDirty("rowHighlights",d,void 0);for(var e in this.get("columnHighlights"))this.setAttributeAndDirty("columnHighlights",e,void 0);for(var f in this.get("entryHighlights"))this.setAttributeAndDirty("entryHighlights",f,void 0);this.setAttributeAndDirty("entryHighlights",
c,!0)}return this};MatrixState.prototype.noHighlights=function(){for(var a in this.getAttribute("rowHighlights"))this.setAttributeAndDirty("rowHighlights",a,void 0);for(var b in this.getAttribute("columnHighlights"))this.setAttributeAndDirty("columnHighlights",b,void 0);for(var c in this.getAttribute("entryHighlights"))this.setAttributeAndDirty("entryHighlights",c,void 0);return this};
MatrixState.prototype.rowExpansions=function(a){if(0<=a&&a<this.__data__.rowDims&&!0!==this.getAttribute("rowExpansions",a)){for(var b in this.getAttribute("rowExpansions"))this.setAttributeAndDirty("rowExpansions",b,void 0);for(var c in this.getAttribute("columnExpansions"))this.setAttributeAndDirty("columnExpansions",c,void 0);this.setAttributeAndDirty("rowExpansions",a,!0)}return this};
MatrixState.prototype.columnExpansions=function(a){if(0<=a&&a<this.__data__.columnDims&&!0!==this.getAttribute("columnExpansions",a)){for(var b in this.getAttribute("rowExpansions"))this.setAttributeAndDirty("rowExpansions",b,void 0);for(var c in this.getAttribute("columnExpansions"))this.setAttributeAndDirty("columnExpansions",c,void 0);this.setAttributeAndDirty("columnExpansions",a,!0)}return this};
MatrixState.prototype.noExpansions=function(){for(var a in this.getAttribute("rowExpansions"))this.setAttributeAndDirty("rowExpansions",a,void 0);for(var b in this.getAttribute("columnExpansions"))this.setAttributeAndDirty("columnExpansions",b,void 0);return this};
MatrixState.prototype.expandNextColumn=function(){var a=_.keys(this.state.get("columnExpansions")).map(function(a){return parseInt(a)})[0];if(void 0!==a){var b=this.__data__.columnDims,c=this.get("columnOrderingType"),a=c.indexOf(a);nextColumnExpansion=c[(a+1)%b];this.columnExpansions(nextColumnExpansion)}return this};
MatrixState.prototype.expandPreviousColumn=function(){if(void 0!==_.keys(this.state.get("columnExpansions")).map(function(a){return parseInt(a)})[0]){var a=this.__data__.columnDims,b=this.get("columnOrderingType"),c=b.indexOf(columnExpansions);prevColumnExpansion=b[(c+a-1)%a];this.columnExpansions(prevColumnExpansion)}return this};
MatrixState.prototype.rowSelections=function(a,b){0<=a&&a<this.__data__.rowDims&&(0<=b&&b<this.get("selectionCount")||void 0===b)&&this.getAttribute("rowSelections",a)!==b&&this.setAttributeAndDirty("rowSelections",a,b);return this};MatrixState.prototype.columnSelections=function(a,b){0<=a&&a<this.__data__.columnDims&&(0<=b&&b<this.get("selectionCount")||void 0===b)&&this.getAttribute("columnSelections",a)!==b&&this.setAttributeAndDirty("columnSelections",a,b);return this};
MatrixState.prototype.noSelections=function(){for(var a in this.getAttribute("rowSelections"))this.setAttributeAndDirty("rowSelections",a,void 0);for(var b in this.getAttribute("columnSelections"))this.setAttributeAndDirty("columnSelections",b,void 0);return this};
MatrixState.prototype.entryPromotionsAndDemotions=function(a,b,c){0<=a&&a<this.__data__.rowDims&&0<=b&&b<this.__data__.columnDims&&(a=a+":"+b,!0!==c&&!1!==c&&void 0!==c||this.getAttribute("entryProDemotions",a)===c||this.setAttributeAndDirty("entryProDemotions",a,c));return this};MatrixState.prototype.rowLabels=function(a,b){0<=a&&a<this.__data__.rowDims&&this.getAttribute("rowLabels",a)!==b&&this.setAttributeAndDirty("rowLabels",a,b);return this};
MatrixState.prototype.columnLabels=function(a,b){0<=a&&a<this.__data__.columnDims&&this.getAttribute("columnLabels",a)!==b&&this.setAttributeAndDirty("columnLabels",a,b);return this};MatrixState.prototype.allRowLabels=function(a){for(var b=this.__initLabels(this.__data__.rowDims,this.CONST.ROW_PREFIX),c=0;c<b.length&&c<a.length;c++)b[c]=a[c];this.setAttributeAndDirty("rowLabels",b);return this};
MatrixState.prototype.allColumnLabels=function(a){for(var b=this.__initLabels(this.__data__.columnDims,this.CONST.COLUMN_PREFIX),c=0;c<b.length&&c<a.length;c++)b[c]=a[c];this.setAttributeAndDirty("columnLabels",b);return this};MatrixState.prototype.__initLabels=function(a,b){for(var c=Array(a),d=0;d<a;d++)c[d]=b+" #"+(d+1);return c};
MatrixState.prototype.selectionLabels=function(a,b){0<=a&&a<this.get("selectionCount")&&this.getAttribute("selectionLabels",a)!==b&&this.setAttributeAndDirty("selectionLabels",a,b);return this};MatrixState.prototype.selectionColors=function(a,b){0<=a&&a<this.get("selectionCount")&&this.getAttribute("selectionColors",a)!==b&&this.setAttributeAndDirty("selectionColors",a,b);return this};
MatrixState.prototype.selectionBackgrounds=function(a,b){0<=a&&a<this.get("selectionCount")&&this.getAttribute("selectionBackgrounds",a)!==b&&this.setAttributeAndDirty("selectionBackgrounds",a,b);return this};"undefined"!==typeof module&&(module.exports=MatrixState);var MatrixInteractions=CoreView.extend();
MatrixInteractions.prototype.CONST={DEFAULT_COLOR:"#7f7f7f",DEFAULT_BACKGROUND:"#c7c7c7",HIGHLIGHT_COLOR:"#d62728",HIGHLIGHT_BACKGROUND:"#ff9896",FONT_SIZE_PT:7.5,ANIMATION_DELAY:275,ANIMATION_DURATION:325,ANIMATION_EASE:"cubic-in-out",ANIMATION_STYLE_DURATION:160,ANIMATION_STYLE_EASE:"linear",ICONS:{PROMOTIONS:"icon-ok-sign",NO_PROMOTIONS:"icon-ok",DEMOTIONS:"icon-remove-sign",NO_DEMOTIONS:"icon-remove",VISIBILITY:"icon-eye-open",ORDERING:"icon-sort",SELECTION:"icon-tag",PRIORITY:"icon-signal"}};
MatrixInteractions.prototype.initialize=function(a){CoreView.prototype.initialize.call(this,a);this.model=a.model;this.state=this.model.state;this.__initInteractions()};
MatrixInteractions.prototype.__registerMouseInteractions=function(){var a=function(a,b,c,d){a?"row"===b?this.state.rowHighlights(c):"column"===b?this.state.columnHighlights(c):this.state.entryHighlights(c,d):this.state.noHighlights()}.bind(this);this.__onMouseOverHighlights=_.debounce(a,50).bind(this);var a=function(a){this.__onMouseOverHighlights(!0,"row",a.data.rowIndex)}.bind(this),b=function(a){this.__onMouseOverHighlights(!0,"column",a.data.columnIndex)}.bind(this),c=function(a){this.__onMouseOverHighlights(!1)}.bind(this),
d=function(a){a=a.data;this.model.get("ui:selectionIndex");a.isExpanded?this.state.noExpansions():this.state.columnExpansions(a.columnIndex);this.model.set("ui:columnIndex",a.columnIndex);d3.event.cancelBubble=!0}.bind(this);return[{pattern:"fired:enter:row",handler:a},{pattern:"fired:exit:row",handler:c},{pattern:"fired:enter:column",handler:b},{pattern:"fired:exit:column",handler:c},{pattern:"fired:enter:cell",handler:b},{pattern:"fired:exit:cell",handler:c},{pattern:"fired:enter:promoteDemote",
handler:b},{pattern:"fired:exit:promoteDemote",handler:c},{pattern:"fired:click:column",handler:d},{pattern:"fired:click:cell",handler:d}]};
MatrixInteractions.prototype.__registerReorderingDragAndDrops=function(){var a=function(a){this.model.set({"ui:dragColor":a.data.isSelected?this.model.get("allSelectionGroups")[a.data.selectionIndex].color:this.CONST.HIGHLIGHT_COLOR,"ui:dragBackground":a.data.isSelected?this.model.get("allSelectionGroups")[a.data.selectionIndex].background:this.CONST.HIGHLIGHT_BACKGROUND});d3.select(a.element).style("background",this.model.get("ui:dragBackground"))}.bind(this),b=function(a){this.model.set({"ui:dragColor":null,
"ui:dragBackground":null});d3.select(a.element).style("background",null)}.bind(this),c=function(a){var b=a.event.offsetY<=a.targetElement.offsetHeight/2;this.model.set({"ui:isDropBefore":b});b?d3.select(a.targetElement).style("border-top","1px solid "+this.model.get("ui:dragColor")).style("border-bottom",null):d3.select(a.targetElement).style("border-top",null).style("border-bottom","1px solid "+this.model.get("ui:dragColor"))}.bind(this),d=function(a){d3.select(a.targetElement).style("border-top",
null).style("border-bottom",null)}.bind(this),e=function(a){d(a);this.model.get("ui:isDropBefore")?this.state.moveRowBefore(a.sourceData.rowIndex,a.targetData.rowIndex):this.state.moveRowAfter(a.sourceData.rowIndex,a.targetData.rowIndex);this.state.noHighlights();this.model.set("ui:rowIndex",a.sourceData.rowIndex)}.bind(this),f=function(a){d(a);this.model.get("ui:isDropBefore")?this.state.moveColumnBefore(a.sourceData.columnIndex,a.targetData.columnIndex):this.state.moveColumnAfter(a.sourceData.columnIndex,
a.targetData.columnIndex);this.state.noHighlights();this.model.set("ui:columnIndex",a.sourceData.columnIndex)}.bind(this);return[{pattern:"fired:dragstart:row",handler:a},{pattern:"fired:dragend:row",handler:b},{pattern:"fired:dragover:row:row",handler:c},{pattern:"fired:dragleave:row:row",handler:d},{pattern:"fired:dragdrop:row:row",handler:e},{pattern:"fired:dragstart:column",handler:a},{pattern:"fired:dragend:column",handler:b},{pattern:"fired:dragover:column:column",handler:c},{pattern:"fired:dragleave:column:column",
handler:d},{pattern:"fired:dragdrop:column:column",handler:f}]};
MatrixInteractions.prototype.__registerSelectionDragAndDrops=function(){var a=function(a){this.model.set({"ui:dragColor":a.data.color,"ui:dragBackground":a.data.background})}.bind(this),b=function(a){this.model.set({"ui:dragColor":null,"ui:dragBackground":null})}.bind(this),c=function(a){d3.select(a.targetElement).style("background",this.model.get("ui:dragBackground"))}.bind(this),d=function(a){d3.select(a.targetElement).style("background",null)}.bind(this),e=function(a){d(a);var b=a.targetData.columnIndex;
a=a.sourceData.selectionIndex;this.state.columnSelections(b,a);this.state.columnHighlights(b);this.model.set("ui:selectionIndex",a)}.bind(this);return[{pattern:"fired:dragstart:selection",handler:a},{pattern:"fired:dragend:selection",handler:b},{pattern:"fired:dragenter:selection:column",handler:c},{pattern:"fired:dragleave:selection:column",handler:d},{pattern:"fired:dragdrop:selection:column",handler:e}]};
MatrixInteractions.prototype.__initInteractions=function(){var a=function(a,d){if("fired:"===a.substr(0,6))for(var e=0;e<b.length;e++)0<=a.search(b[e].pattern)&&b[e].handler(d)}.bind(this),b=[];Array.prototype.push.apply(b,this.__registerMouseInteractions());Array.prototype.push.apply(b,this.__registerReorderingDragAndDrops());Array.prototype.push.apply(b,this.__registerSelectionDragAndDrops());this.on("all",a)};var MatrixModel=CoreModel.extend({defaults:{visibleRowDims:0,visibleColumnDims:0,visibleAnnotationDims:0,visibleSelectionDims:0,maxValue:0,maxRowValue:0,maxColumnValue:0,expansionColumnPosition:void 0,highlightSelectionIndex:void 0,"vis:schedules":void 0,"ui:dragActive":!1,"ui:dragData":void 0,"ui:dragElement":void 0,"ui:rowIndex":0,"ui:columnIndex":0,"ui:selectionIndex":0}});MatrixModel.prototype.initialize=function(a){CoreModel.prototype.initialize.call(this,a);this.state=a.state;this.__initStateEvents()};
MatrixModel.prototype.__initStateEvents=function(){this.__isUpdating=!1;this.__pendingStateEvents={};this.__currentStateEvents={};this.__currentModelEvents={};this.__rescheduleModelUpdates=_.debounce(this.__scheduleModelUpdates,20);this.listenTo(this.state,"dirty",this.__onStateEvents)};MatrixModel.prototype.__onStateEvents=function(a){this.__pendingStateEvents=this.__combineDirty__(this.__pendingStateEvents,a);this.__scheduleModelUpdates()};
MatrixModel.prototype.__scheduleModelUpdates=function(){this.__isUpdating&&this.__rescheduleModelUpdates();this.__isUpdating=!0;this.__currentStateEvents=this.__pendingStateEvents;this.__pendingStateEvents={};this.__currentModelEvents={};this.__updateModel();this.triggerDirty();this.__isUpdating=!1};MatrixModel.prototype.__isDirtyState=function(){var a=Array.prototype.slice.call(arguments);return this.__isDirty__(this.__currentStateEvents,a,0)};
MatrixModel.prototype.__getDirtyState=function(){var a=Array.prototype.slice.call(arguments);return this.__getDirty__(this.__currentStateEvents,a,0)};MatrixModel.prototype.__isDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__isDirty__(this.__currentModelEvents,a,0)};MatrixModel.prototype.__setDirtyModel=function(){var a=Array.prototype.slice.call(arguments);this.__currentModelEvents=this.__setDirty__(this.__currentModelEvents,a,0)};
MatrixModel.prototype.__getDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__getDirty__(this.__currentModelEvents,a,0)};MatrixModel.prototype.__setDirtyModelAndValue=function(a,b){this.set(a,b);this.__setDirtyModel(a)};MatrixModel.prototype.__setDirtyModelAndValues=function(a){for(var b in a)this.set(b,a[b]),this.__setDirtyModel(b)};
MatrixModel.prototype.__updateModel=function(){this.__initEntries();this.__precomputeRelValues();this.__precomputeHighlights();this.__precomputeRankingsAndQuantiles();this.__updateSelections();this.__updateHighlights();this.__updateExpansions();this.__updateInclusionsAndExclusions();this.__updatePromotionsAndDemotions();this.__updateVisibilities();this.__updateRowAbsOrdering();this.__updateColumnAbsOrdering();this.__updateRowPositions();this.__updateColumnPositions();this.__updateEntryValues();this.__updateRowColumnValues();
this.__updateCrossRefValues();this.__updateCrossRefPositionsAndSizes();this.__updateTexts();this.__updateRowMetas();this.__updateColumnMetas();this.__updateAnnotationControls();this.__updateSelectionGroups();this.__filterDataset();this.__scheduleVisTasks()};MatrixModel.prototype.__entryIndexes=function(a){return!0===a||void 0===a?_.keys(this.get("hashEntries")):_.keys(a)};MatrixModel.prototype.__rowIndexes=function(a){return!0===a||void 0===a?_.range(this.get("allRowElements").length):_.keys(a).map(function(a){return parseInt(a)})};
MatrixModel.prototype.__columnIndexes=function(a){return!0===a||void 0===a?_.range(this.get("allColumnElements").length):_.keys(a).map(function(a){return parseInt(a)})};MatrixModel.prototype.__selectionIndexes=function(a){return!0===a||void 0===a?_.range(this.state.get("selectionCount")):_.keys(a).map(function(a){return parseInt(a)})};
MatrixModel.prototype.__updateColumnMetas=function(){for(var a=this.get("allColumnMetas"),b=this.state.get("columnExpansions"),c=0;c<a.length;c++){var d=a[c],e=!0===d.isVisible,f=b.hasOwnProperty(c);d.isEnter=!e&&f;d.isStay=e&&f;d.isExit=e&&!f;f!==d.isVisible&&(d.isVisible=f,this.setDirty("allColumnMetas",d.key,"isVisible"),this.__setDirtyModel("allColumnMetas","isVisible"))}this.__setDirtyModel("allColumnMetas",["isEnter","isStay","isExit"])};
MatrixModel.prototype.__updateRowMetas=function(){for(var a=this.get("allRowMetas"),b=0;b<a.length;b++){var c=a[b];c.isEnter=!1;c.isStay=!1;c.isExit=!1;!1!==c.isVisible&&(c.isVisible=!1,this.setDirty("allRowMetas",c.key,"isVisible"),this.__setDirtyModel("allRowMetas","isVisible"))}this.__setDirtyModel("allRowMetas",["isEnter","isStay","isExit"])};
MatrixModel.prototype.__filterDataset=function(){!0===this.getDirty()&&this.__setDirtyModelAndValues({visibleEntries:void 0,visibleRowElements:void 0,visibleColumnElements:void 0,visibleRowCrossRefs:void 0,visibleColumnCrossRefs:void 0,visibleAnnotationControls:void 0,visibleRowMetas:void 0,visibleColumnMetas:void 0});var a=this.get("allEntries"),b=this.get("allRowElements"),c=this.get("allColumnElements"),d=this.get("allRowCrossRefs"),e=this.get("allColumnCrossRefs"),f=this.get("allAnnotationControls"),
h=this.get("allRowMetas"),g=this.get("allColumnMetas"),a=_.filter(a,function(a){return a.isEnter}),b=_.filter(b,function(a){return a.isEnter}),c=_.filter(c,function(a){return a.isEnter}),d=_.filter(d,function(a){return a.isEnter}),e=_.filter(e,function(a){return a.isEnter}),f=_.filter(f,function(a){return a.isEnter}),h=_.filter(h,function(a){return a.isEnter}),k=_.filter(g,function(a){return a.isEnter}),g=(this.get("visibleEntries")||[]).concat(a),a=(this.get("visibleRowElements")||[]).concat(b),
b=(this.get("visibleColumnElements")||[]).concat(c),c=(this.get("visibleRowCrossRefs")||[]).concat(d),d=(this.get("visibleColumnCrossRefs")||[]).concat(e),e=(this.get("visibleAnnotationControls")||[]).concat(f),h=(this.get("visibleRowMetas")||[]).concat(h),l=(this.get("visibleColumnMetas")||[]).concat(k),m=_.reject(g,function(a){return a.isExit}),n=_.reject(a,function(a){return a.isExit}),k=_.reject(b,function(a){return a.isExit}),p=_.reject(c,function(a){return a.isExit}),q=_.reject(d,function(a){return a.isExit}),
f=_.reject(e,function(a){return a.isExit}),r=_.reject(h,function(a){return a.isExit}),x=_.reject(l,function(a){return a.isExit});this.__setDirtyModelAndValues({visibleEntries:m,visibleRowElements:n,visibleColumnElements:k,visibleRowCrossRefs:p,visibleColumnCrossRefs:q,visibleAnnotationControls:f,visibleRowMetas:r,visibleColumnMetas:x,transitionEntries:g,transitionRowElements:a,transitionColumnElements:b,transitionRowCrossRefs:c,transitionColumnCrossRefs:d,transitionAnnotationControls:e,transitionRowMetas:h,
transitionColumnMetas:l});g=n.length;a=k.length;b=f.length;g!==this.get("visibleRowDims")&&(this.set("visibleRowDims",g),this.setDirty("visibleRowDims"));a!==this.get("visibleColumnDims")&&(this.set("visibleColumnDims",a),this.setDirty("visibleColumnDims"));b!==this.get("visibleAnnotationDims")&&(this.set("visibleAnnotationDims",b),this.setDirty("visibleAnnotationDims"))};MatrixModel.prototype.RESIZE_DURATION=180;
MatrixModel.prototype.STANDARD_SCHEDULE=function(){return{enter:{delay:225,duration:300,ease:"cubic-in-out"},stay:{delay:-200,duration:400,ease:"cubic-in-out"},exit:{delay:-525,duration:300,ease:"cubic-in-out"}}}();MatrixModel.prototype.ADDITIONAL_SCHEDULES=function(){return{}}();
MatrixModel.prototype.__scheduleVisTasks=function(){function a(a){return a.isEnter}function b(a){return a.isStay}function c(a){return a.isExit}for(var d="allEntries allRowElements allColumnElements allRowCrossRefs allColumnCrossRefs allRowMetas allColumnMetas allAnnotationControls".split(" "),e=[],f={},h=0;h<d.length;h++){var g=d[h].replace(/^all/,"transition"),k=this.get(g),l=_.some(k,a),m=_.some(k,b),k=_.some(k,c),n={isEnter:l,isStay:m,isExit:k};l&&(l=this.ADDITIONAL_SCHEDULES.hasOwnProperty(g)?
_.clone(this.ADDITIONAL_SCHEDULES[g].enter):_.clone(this.STANDARD_SCHEDULE.enter),n.enter=l,e.push(l));m&&(l=this.ADDITIONAL_SCHEDULES.hasOwnProperty(g)?_.clone(this.ADDITIONAL_SCHEDULES[g].stay):_.clone(this.STANDARD_SCHEDULE.stay),n.stay=l,e.push(l));k&&(l=this.ADDITIONAL_SCHEDULES.hasOwnProperty(g)?_.clone(this.ADDITIONAL_SCHEDULES[g].exit):_.clone(this.STANDARD_SCHEDULE.exit),n.exit=l,e.push(l));f[g]=n}g=d=void 0;for(h=0;h<e.length;h++)l=e[h],m=l.delay+l.duration,d=Math.min(d||0,l.delay),g=Math.max(g||
0,m);d||(d=0);g||(g=0);for(h=0;h<e.length;h++)l=e[h],l.delay-=d;e=g-d;f.duration=e;f.vis={pre:{delay:0,duration:this.RESIZE_DURATION,ease:"cubic-in-out"},post:{delay:e-this.RESIZE_DURATION,duration:this.RESIZE_DURATION,ease:"cubic-in-out"}};this.set("vis:schedules",f)};"undefined"!==typeof module&&(module.exports=MatrixModel);MatrixModel.prototype.__updateAnnotationControls=function(){!0===this.__getDirtyState()&&(this.__setDirtyModelAndValue("hashAnnotationControls",{}),this.__setDirtyModelAndValue("allAnnotationControls",[]));if(this.__isDirtyState("columnExpansions")||this.__isDirtyModel("allRowElements","isVisible")){for(var a=this.get("hashAnnotationControls")||{},b=this.get("allAnnotationControls")||[],c=[],d=[],e=this.get("allRowElements"),f=this.state.get("columnExpansions"),h=0;h<e.length;h++)e[h].isVisible&&
c.push(h);for(var g in f)d.push(parseInt(g));for(var f=[],k=0;k<c.length;k++)for(var h=c[k],l=0;l<d.length;l++)g=d[l],e=h+":"+g,a.hasOwnProperty(e)||(g={rowIndex:h,columnIndex:g,key:e,dataType:"promoteDemote"},a[e]=g,f.push(g));0<f.length&&(this.__setDirtyModelAndValue("hashAnnotationControls",a),this.__setDirtyModelAndValue("allAnnotationControls",b.concat(f)))}b=this.get("allAnnotationControls")||[];if(!0===this.__getDirtyModel("allAnnotationControls")||this.__isDirtyModel("allColumnElements","columnPosition"))for(e=
this.get("allColumnElements"),a=0;a<b.length;a++)g=b[a],c=e[g.columnIndex].columnPosition,c!==g.columnPosition&&(g.columnPosition=c,this.setDirty("allAnnotationControls",g.key,"columnPosition"),this.__setDirtyModel("allAnnotationControls","columnPosition"));if(!0===this.__getDirtyModel("allAnnotationControls")||this.__isDirtyModel("allRowElements","rowPosition"))for(e=this.get("allRowElements"),a=0;a<b.length;a++)g=b[a],c=e[g.rowIndex].rowPosition,c!==g.rowPosition&&(g.rowPosition=c,this.setDirty("allAnnotationControls",
g.key,"rowPosition"),this.__setDirtyModel("allAnnotationControls","rowPosition"));if(!0===this.__getDirtyModel("allAnnotationControls")||this.__isDirtyModel("allRowElements","text"))for(e=this.get("allRowElements"),a=0;a<b.length;a++)g=b[a],c=e[g.rowIndex].text,c!==g.text&&(g.text=c,this.setDirty("allAnnotationControls",g.key,"text"),this.__setDirtyModel("allAnnotationControls","text"));if(!0===this.__getDirtyModel("allAnnotationControls")||this.__isDirtyModel("allColumnElements",["isSelected","selectionIndex"]))for(e=
this.get("allColumnElements"),a=0;a<b.length;a++)g=b[a],c=e[g.columnIndex],d=c.isSelected,d!==g.isSelected&&(g.isSelected=d,g.isSelected?g.selectionIndex=c.selectionIndex:delete g.selectionIndex,this.setDirty("allAnnotationControls",g.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allAnnotationControls",["isSelected","selectionIndex"]));if(!0===this.__getDirtyModel("allAnnotationControls")||this.__isDirtyState("entryProDemotions"))for(c=this.state.get("entryProDemotions"),a=0;a<b.length;a++)if(g=
b[a],e=g.key,d=!0===c[e],e=!1===c[e],d!==g.isPromoted||e!==g.isDemoted)g.isPromoted=d,g.isDemoted=e,this.setDirty("allAnnotationControls",g.key,["isPromted","isDemoted"]),this.__setDirtyModel("allAnnotationControls",["isPromoted","isDemoted"]);e=this.get("allRowElements");f=this.state.get("columnExpansions");for(a=0;a<b.length;a++)g=b[a],c=!0===g.isVisible,d=e[g.rowIndex].isVisible&&f.hasOwnProperty(g.columnIndex),g.isEnter=!c&&d,g.isStay=c&&d,g.isExit=c&&!d,d!==g.isVisible&&(g.isVisible=d,this.setDirty("allAnnotationControls",
g.key,"isVisible"),this.__setDirtyModel("allAnnotationControls",["isEnter","isStay","isExit","isVisible"]))};MatrixModel.prototype.__updateRowAbsOrdering=function(){if(this.__isDirtyState("rowOrderingType")||this.__isDirtyState("rowUserDefinedOrdering")||this.__isDirtyState("rowAutoOrderingBaseList globalOrderedRowCount globalOrderedRowQuantile columnOrderedRowCounts columnOrderedRowQuantiles selectionOrderedRowCounts selectionOrderedRowQuantiles expansionOrderedRowCounts expansionOrderedRowQuantiles".split(" "))||this.__isDirtyState("columnExpansions")){var a=this.state.get("rowOrderingType"),b=void 0;
"auto"===a&&(b=this.__getRowAutoOrdering());"user"===a&&(b=this.state.get("rowUserDefinedOrdering"));this.state.set("rowCurrentOrdering",b);this.__setDirtyModelAndValue("rowAbsOrdering",b)}};
MatrixModel.prototype.__updateColumnAbsOrdering=function(){if(this.__isDirtyState("columnOrderingType")||this.__isDirtyState("columnUserDefinedOrdering")){var a=this.state.get("columnOrderingType"),b=void 0;"auto"===a&&(b=this.__getColumnAutoOrdering());"user"===a&&(b=this.state.get("columnUserDefinedOrdering"));this.state.set("columnCurrentOrdering",b);this.__setDirtyModelAndValue("columnAbsOrdering",b)}};
MatrixModel.prototype.__getRowAutoOrdering=function(){for(var a=function(){for(var a=this.get("globalRowRankingIndexes"),b=this.get("globalRowRankingWeights"),c=this.get("globalRowQuantileIndexes"),d=this.state.get("globalOrderedRowCount"),e=this.state.get("globalOrderedRowQuantile"),f=0;f<d&&f<a.length;f++)g[a[f]].weights.push(b[f]);for(f=0;f<e;f++)for(a=(100-f)/100,b=0;b<c[f].length;b++)g[c[f][b]].weights.push(a)}.bind(this),b=function(){for(var a=this.state.get("columnOrderedRowCounts"),b=this.state.get("columnOrderedRowQuantiles"),
c=0;c<h.length;c++){for(var d=h[c],e=0,f=a.hasOwnProperty(c)?a[c]:0,k=d.rowRankingIndexes,v=d.rowRankingWeights,t=0;t<f&&t<k.length;t++)g[k[t]].weights.push(v[t]),e++;k=b.hasOwnProperty(c)?b[c]:0;v=d.rowQuantileIndexes;for(t=0;t<k;t++)for(var w=(100-t)/100,u=0;u<v[t].length;u++)g[v[t][u]].weights.push(w),e++;e!==d.numOrdered&&(d.numOrdered=e,this.setDirty("allColumnElements",d.key,"numOrdered"),this.__setDirtyModel("allColumnElements","numOrdered"));f!==d.orderedRowCount&&(d.orderedRowCount=f,this.setDirty("allColumnElements",
d.key,"orderedRowCount"),this.__setDirtyModel("allColumnElements","orderedRowCount"));k!==d.orderedRowQuantile&&(d.orderedRowQuantile=k,this.setDirty("allColumnElements",d.key,"orderedRowQuantile"),this.__setDirtyModel("allColumnElements","orderedRowQuantile"))}}.bind(this),c=function(){var a=this.state.get("columnSelections"),b=this.state.get("selectionOrderedRowCounts"),c=this.state.get("selectionOrderedRowQuantiles"),d;for(d in a){for(var e=a[d],f=h[d],k=allSelectionGroups[e],v=0,t=b.hasOwnProperty(e)?
b[e]:0,w=f.rowRankingIndexes,u=f.rowRankingWeights,s=0;s<t&&s<w.length;s++)g[w[s]].weights.push(u[s]),v++;e=c.hasOwnProperty(e)?c[e]:0;f=f.rowQuantileIndexes;for(s=0;s<e;s++)for(w=(100-s)/100,u=0;u<f[s].length;u++)g[f[s][u]].weights.push(w),v++;v!==k.numOrdered&&(k.numOrdered=v,this.setDirty("allSelectionGroups",k.key,"numOrdered"),this.__setDirtyModel("allSelectionGroups","numOrdered"));t!==k.orderedRowCount&&(k.orderedRowCount=t,this.setDirty("allSelectionGroups",k.key,"orderedRowCount"),this.__setDirtyModel("allSelectionGroups",
"orderedRowCount"));e!==k.orderedRowQuantile&&(k.orderedRowQuantile=e,this.setDirty("allSelectionGroups",k.key,"orderedRowQuantile"),this.__setDirtyModel("allSelectionGroups","orderedRowQuantile"))}}.bind(this),d=function(){var a=this.state.get("columnOrderedRowCounts"),b=this.state.get("columnOrderedRowQuantiles"),c=this.state.get("expansionOrderedRowCount"),d=this.state.get("expansionOrderedRowQuantile"),e=this.get("allColumnElements"),f=this.state.get("columnExpansions"),h;for(h in f){var k=e[h],
f=0;if(!a.hasOwnProperty(h))for(var t=c,w=k.rowRankingIndexes,u=k.rowRankingWeights,s=0;s<t&&s<w.length;s++)g[w[s]].weights.push(u[s]),f++;if(!b.hasOwnProperty(h))for(t=d,k=k.rowQuantileIndexes,s=0;s<t;s++)for(w=(100-s)/100,u=0;u<k[s].length;u++)g[k[s][u]].weights.push(w),f++}}.bind(this),e=this.state.get("rowAutoOrderingBaseList"),f=this.get("allRowElements"),h=this.get("allColumnElements"),g=Array(f.length),k=0;k<f.length;k++)g[k]={index:k,weights:[]};a();b();c();d();for(k=0;k<f.length;k++){a=g[k].weights;
b=1;for(c=0;c<a.length;c++)b*=1-a[c];g[k].priority=1-b}for(c=0;c<e.length;c++)k=e[c],g[k].priority-=1E-8*c/e.length;g.sort(function(a,b){return b.priority-a.priority});e=Array(f.length);for(k=0;k<f.length;k++)e[k]=g[k].index;return e};MatrixModel.prototype.__getColumnAutoOrdering=function(){var a=this.get("allColumnElements");return _.range(a.length)};
MatrixModel.prototype.__updateRowPositions=function(){if(this.__isDirtyModel("rowAbsOrdering")||this.__isDirtyModel("allRowElements","isVisible")){var a=this.get("rowAbsOrdering"),b=this.get("allRowElements"),a=this.__interpolateOrderingPositions(b,a);this.__setDirtyModelAndValue("rowPositions",a)}this.__isDirtyModel("rowPositions")&&(a=this.get("rowPositions"),this.__onRowPositions(a))};
MatrixModel.prototype.__onRowPositions=function(a){for(var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allRowCrossRefs"),e=0;e<b.length;e++){var f=b[e],h=a[f.rowIndex];h!==f.rowPosition&&(f.rowPosition=h,this.setDirty("allEntries",f.key,"rowPosition"),this.__setDirtyModel("allEntries","rowPosition"))}for(b=0;b<c.length;b++)e=c[b],h=a[b],h!==e.rowPosition&&(e.rowPosition=h,this.setDirty("allRowElements",e.key,"rowPosition"),this.__setDirtyModel("allRowElements","rowPosition"));
for(a=0;a<d.length;a++)c=d[a],h=c.parent.rowPosition,h!==c.rowPosition&&(c.rowPosition=h,this.setDirty("allRowCrossRefs",c.key,"rowPosition"),this.__setDirtyModel("allRowCrossRefs","rowPosition"))};
MatrixModel.prototype.__updateColumnPositions=function(){if(this.__isDirtyModel("columnAbsOrdering")||this.__isDirtyModel("allColumnElements","isVisible")){var a=this.get("columnAbsOrdering"),b=this.get("allColumnElements"),a=this.__interpolateOrderingPositions(b,a);this.__setDirtyModelAndValue("columnPositions",a)}this.__isDirtyModel("columnPositions")&&(a=this.get("columnPositions"),this.__onColumnPositions(a));if(this.__isDirtyModel("columnPositions")||this.__isDirtyState("columnExpansions"))a=
this.get("columnPositions"),b=this.state.get("columnExpansions"),b=_.keys(b).map(function(a){return parseInt(a)})[0],this.__onExpansionColumnPosition(a,b)};
MatrixModel.prototype.__onColumnPositions=function(a){for(var b=this.get("allEntries"),c=this.get("allColumnElements"),d=this.get("allColumnCrossRefs"),e=0;e<b.length;e++){var f=b[e],h=a[f.columnIndex];h!==f.columnPosition&&(f.columnPosition=h,this.setDirty("allEntries",f.key,"columnPosition"),this.__setDirtyModel("allEntries","columnPosition"))}for(b=0;b<c.length;b++)e=c[b],h=a[b],h!==e.columnPosition&&(e.columnPosition=h,this.setDirty("allColumnElements",e.key,"columnPosition"),this.__setDirtyModel("allColumnElements",
"columnPosition"));for(a=0;a<d.length;a++)c=d[a],h=c.parent.columnPosition,h!==c.columnPosition&&(c.columnPosition=h,this.setDirty("allColumnCrossRefs",c.key,"columnPosition"),this.__setDirtyModel("allColumnCrossRefs","columnPosition"))};MatrixModel.prototype.__onExpansionColumnPosition=function(a,b){var c=void 0;void 0!==b&&(c=a[b]);c!==this.get("expansionColumnPosition")&&(this.set("expansionColumnPosition",c),this.setDirty("expansionColumnPosition"))};
MatrixModel.prototype.__interpolateOrderingPositions=function(a,b){for(var c=Array(a.length),d=0;d<a.length;d++)c[d]=void 0;for(var e=[],f=[],d=0;d<a.length;d++){var h=b[d];a[h].isVisible&&(e.push(h),f.push(d))}for(d=0;d<e.length;d++)c[e[d]]=d;return c};MatrixModel.prototype.__initEntries=function(){function a(a,b,c){a=[];for(b=0;b<c.length;b++){var d=c[b];d.key=d.rowIndex+":"+d.columnIndex;d.dataType="cell";d.absValue=d.value;d.hasEntry=!0;a.push(d)}a.sort(function(a,b){return b.absValue-a.absValue});return a}function b(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.key]=d}return b}function c(a,b){for(var c=Array(a),d=0;d<a;d++)c[d]={key:d,rowIndex:d,absValue:0,dataType:"row",crossRefs:{},isAdmitted:b[d]};for(d=0;d<r.length;d++){var e=r[d];
c[e.rowIndex].absValue+=e.absValue}return c}function d(a,b){for(var c=Array(a),d=0;d<a;d++)c[d]={key:d,columnIndex:d,absValue:0,dataType:"column",crossRefs:{},isAdmitted:b[d]};for(d=0;d<r.length;d++){var e=r[d];c[e.columnIndex].absValue+=e.absValue}return c}function e(a,b){for(var c=[],d=0;d<r.length;d++){var e=r[d],f=e.rowIndex,g=e.columnIndex,h=x[f],e={key:f+":"+g,rowIndex:f,columnIndex:g,dataType:"column",parent:h,entry:e};h.crossRefs[g]=e;c.push(e)}return c}function f(a){for(var b={},c=0;c<a.length;c++){var d=
a[c];b[d.key]=d}return b}function h(a,b){for(var c=[],d=0;d<r.length;d++){var e=r[d],f=e.rowIndex,g=e.columnIndex,h=v[g],e={key:f+":"+g,rowIndex:f,columnIndex:g,dataType:"row",parent:h,entry:e};h.crossRefs[f]=e;c.push(e)}return c}function g(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.key]=d}return b}function k(a){for(var b=Array(a.length),c=0;c<a.length;c++)b[c]={key:c,rowIndex:c,element:a[c],dataType:"rowMeta"};return b}function l(a){for(var b=Array(a.length),c=0;c<a.length;c++){var d=a[c];
b[c]={key:c,columnIndex:c,element:d,dataType:"columnMeta",visibility:[{key:c,columnIndex:c,element:d,dataType:"columnVisibility"}],ordering:[{key:c,columnIndex:c,element:d,dataType:"columnOrdering"}]}}return b}if(this.__isDirtyState("dataID")){var m=this.state.__data__.rowDims,n=this.state.__data__.columnDims,p=this.state.__data__.rowAdmissions,q=this.state.__data__.columnAdmissions,r=a(m,n,this.state.__data__.sparseMatrix),x=c(m,p),v=d(n,q),p=e(m,n),m=h(m,n),n=k(x),q=l(v),t=b(r),w=f(p),u=g(m);this.setDirty();
this.__setDirtyModelAndValues({allEntries:r,allRowElements:x,allColumnElements:v,allRowCrossRefs:p,allColumnCrossRefs:m,allRowMetas:n,allColumnMetas:q,hashEntries:t,hashRowCrossRefs:w,hashColumnCrossRefs:u})}};
MatrixModel.prototype.__precomputeRelValues=function(){function a(){for(var a=0,b=0,c=0;c<f.length;c++)var d=f[c].absValue,a=a+d,b=Math.max(b,d);for(c=0;c<f.length;c++)d=f[c],d.relValue=d.absValue/a;k=b/a}function b(){for(var a=0,b=0,c=0;c<h.length;c++)var d=h[c].absValue,a=a+d,b=Math.max(b,d);for(c=0;c<h.length;c++)d=h[c],d.relValue=d.absValue/a;l=b/a}function c(){for(var a=0,b=0,c=0;c<g.length;c++)var d=g[c].absValue,a=a+d,b=Math.max(b,d);for(c=0;c<g.length;c++)d=g[c],d.relValue=d.absValue/a;m=
b/a}function d(){for(var a=0,b=0;b<f.length;b++){var c=f[b],d=c.absValue/h[c.rowIndex].absValue;c.rowRelValue=d;a+=d}n=a}function e(){for(var a=0,b=0;b<f.length;b++){var c=f[b],d=c.absValue/g[c.columnIndex].absValue;c.columnRelValue=d;a+=d}p=a}if(this.__isDirtyModel(["allEntries","allRowElements","allColumnElements"],"absValue")){var f=this.get("allEntries"),h=this.get("allRowElements"),g=this.get("allColumnElements"),k=0,l=0,m=0,n=0,p=0;a();b();c();d();e();this.__setDirtyModel("allEntries",["relValue",
"rowRelValue","columnRelValue"]);this.__setDirtyModel("allRowElements","relValue");this.__setDirtyModel("allColumnElements","relValue");this.__setDirtyModelAndValue("maxJointProbability",k);this.__setDirtyModelAndValue("maxRowMarginalProbability",l);this.__setDirtyModelAndValue("maxColumnMarginalProbability",m);this.__setDirtyModelAndValue("rowRescaleMultiplier",n);this.__setDirtyModelAndValue("columnRescaleMultiplier",p)}};
MatrixModel.prototype.__precomputeHighlights=function(){if(this.__isDirtyState("highlightThreshold")||this.__isDirtyModel("allEntries","relValue")){for(var a=this.state.get("highlightThreshold"),b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=0;e<c.length;e++){var f=c[e];f.columnHighlights={}}for(var h=0;h<d.length;h++)f=d[h],f.rowHighlights={};for(f=0;f<b.length;f++){var g=b[f],e=g.rowIndex,h=g.columnIndex;g.relValue>=a&&(c[e].columnHighlights[h]=!0,d[h].rowHighlights[e]=
!0)}this.__setDirtyModel("allRowElements","columnHighlights");this.__setDirtyModel("allColumnElements","rowHighlights")}};
MatrixModel.prototype.__precomputeRankingsAndQuantiles=function(){function a(){for(var a=[],b=0;b<g.length;b++){var c=g[b];c.relValue>=f&&a.push({index:c.rowIndex,relValue:c.relValue})}a=e(a);l=a.rankingIndexes;m=a.rankingWeights;n=a.quantileIndexes;p=a.quantileCounts}function b(){for(var a=[],b=0;b<k.length;b++){var c=k[b];c.relValue>=f&&a.push({index:c.columnIndex,relValue:c.relValue})}a=e(a);q=a.rankingIndexes;r=a.rankingWeights;x=a.quantileIndexes;v=a.quantileCounts}function c(){for(var a=_.range(g.length).map(function(){return[]}),
b=0;b<h.length;b++){var c=h[b];c.rowRelValue>=f&&a[c.rowIndex].push({index:c.columnIndex,relValue:c.rowRelValue})}for(b=0;b<g.length;b++){var c=e(a[b]),d=g[b];d.columnRankingIndexes=c.rankingIndexes;d.columnRankingWeights=c.rankingWeights;d.columnQuantileIndexes=c.quantileIndexes;d.columnQuantileCounts=c.quantileCounts}}function d(){for(var a=_.range(k.length).map(function(){return[]}),b=0;b<h.length;b++){var c=h[b];c.columnRelValue>=f&&a[c.columnIndex].push({index:c.rowIndex,relValue:c.columnRelValue})}for(b=
0;b<k.length;b++){var c=e(a[b]),d=k[b];d.rowRankingIndexes=c.rankingIndexes;d.rowRankingWeights=c.rankingWeights;d.rowQuantileIndexes=c.quantileIndexes;d.rowQuantileCounts=c.quantileCounts}}function e(a){a.sort(function(a,b){return b.relValue-a.relValue});for(var b=1,c=0;c<a.length;c++)a[c].weight=b,b-=a[c].relValue;for(var b=[],d=[],c=0;c<a.length;c++)b.push(a[c].index),d.push(a[c].relValue);for(var e=_.range(100).map(function(){return[]}),f=_.range(100).map(function(){return 0}),c=0;c<a.length;c++){var g=
Math.max(0,Math.min(100,Math.floor(100-100*a[c].weight)));e[g].push(a[c].index);f[g]=c}return{rankingIndexes:b,rankingWeights:d,quantileIndexes:e,quantileCounts:f}}if(!0===this.__getDirtyState()){var f=this.state.get("rankingThreshold"),h=this.get("allEntries"),g=this.get("allRowElements"),k=this.get("allColumnElements"),l=void 0,m=void 0,n=void 0,p=void 0,q=void 0,r=void 0,x=void 0,v=void 0;a();b();c();d();this.__setDirtyModelAndValue("globalRowRankingIndexes",l);this.__setDirtyModelAndValue("globalRowRankingWeights",
m);this.__setDirtyModelAndValue("globalRowQuantileIndexes",n);this.__setDirtyModelAndValue("globalRowQuantileCounts",p);this.__setDirtyModelAndValue("globalColumnRankingIndexes",q);this.__setDirtyModelAndValue("globalColumnRankingWeights",r);this.__setDirtyModelAndValue("globalColumnQuantileIndexes",x);this.__setDirtyModelAndValue("globalColumnQuantileCounts",v);this.__setDirtyModel("allRowElements",["columnRankingIndexes","columnRankingWeights","columnQuantileIndexes","columnQuantileCounts"]);this.__setDirtyModel("allColumnElements",
["rowRankingIndexes","rowRankingWeights","rowQuantileIndexes","rowQuantileCounts"])}};MatrixModel.prototype.__updateSelectionGroups=function(){if(this.__isDirtyState("selectionCount")){for(var a=this.state.get("selectionCount"),b=this.get("hashSelectionGroups")||{},c=this.get("allSelectionGroups")||[],d=[],e=0;e<a;e++)if(!b.hasOwnProperty(e)){var f={key:e,selectionIndex:e,dataType:"selection"};b[e]=f;d.push(f)}0<d.length&&(this.__setDirtyModelAndValue("hashSelectionGroups",b),this.__setDirtyModelAndValue("allSelectionGroups",c.concat(d)))}c=this.get("allSelectionGroups")||[];if(!0===
this.__getDirtyModel("allSelectionGroups")||this.__isDirtyState("selectionLabels"))for(d=this.state.get("selectionLabels"),a=this.__selectionIndexes(this.__getDirtyState("selectionLabels")),b=0;b<a.length;b++){var e=a[b],f=c[e],h=d[e];h!==f.text&&(f.text=h,this.setDirty("allSelectionGroups",e,"text"),this.__setDirtyModel("allSelectionGroups","text"))}if(!0===this.__getDirtyModel("allSelectionGroups")||this.__isDirtyState("selectionColors"))for(d=this.state.get("selectionColors"),a=this.__selectionIndexes(this.__getDirtyState("selectionColors")),
b=0;b<a.length;b++)e=a[b],f=c[e],h=d[e],h!==f.color&&(f.color=h,this.setDirty("allSelectionGroups",e,"color"),this.__setDirtyModel("allSelectionGroups","color"));if(!0===this.__getDirtyModel("allSelectionGroups")||this.__isDirtyState("selectionBackgrounds"))for(d=this.state.get("selectionBackgrounds"),a=this.__selectionIndexes(this.__getDirtyState("selectionBackgrounds")),b=0;b<a.length;b++)e=a[b],f=c[e],h=d[e],h!==f.background&&(f.background=h,this.setDirty("allSelectionGroups",e,"background"),this.__setDirtyModel("allSelectionGroups",
"background"));if(!0===this.__getDirtyModel("allSelectionGroups")||this.__isDirtyState("columnSelections")){f=this.state.get("columnSelections");b=this.get("allColumnElements");a=Array(c.length);for(e=0;e<a.length;e++)a[e]={};for(var g in f)g=parseInt(g),d=b[g],e=f[g],a[e][g]=d;for(e=0;e<c.length;e++)if(f=c[e],g=f.columnIndexes,b=_.keys(a[e]),d=g?_.keys(g):[],void 0===g||0<_.difference(b,d).length||0<_.difference(d,b).length)f.columnIndexes=a[e],this.setDirty("allSelectionGroups",e,"columnIndexes"),
this.__setDirtyModel("allSelectionGroups","columnIndexes")}};MatrixModel.prototype.__updateSelections=function(){if(this.__isDirtyState("columnSelections")){var a=this.state.get("columnSelections");this.__onColumnSelections_shortcutLoops(a)}};
MatrixModel.prototype.__onColumnSelections_exhaustiveLoops=function(a){for(var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("allRowCrossRefs"),f=this.get("allColumnCrossRefs"),h=0;h<b.length;h++){var g=b[h],k=a[g.columnIndex],l=0<=k;if(k!==g.selectionIndex||l!==g.isSelected)g.selectionIndex=k,g.isSelected=l,this.setDirty("allEntries",g.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allEntries",["isSelected","selectionIndex"])}for(h=0;h<
c.length;h++)if(b=c[h],k=void 0,l=!1,k!==b.selectionIndex||l!==b.isSelected)b.selectionIndex=k,b.isSelected=l,this.setDirty("allRowElements",b.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allRowElements",["isSelected","selectionIndex"]);for(c=0;c<d.length;c++)if(b=d[c],k=a[c],l=0<=k,k!==b.selectionIndex||l!==b.isSelected)b.selectionIndex=k,b.isSelected=l,this.setDirty("allColumnElements",b.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allColumnElements",["isSelected","selectionIndex"]);
for(c=0;c<e.length;c++)if(d=e[c],k=a[d.columnIndex],l=0<=k,k!==d.selectionIndex||l!==d.isSelected)d.selectionIndex=k,d.isSelected=l,this.setDirty("allRowCrossRefs",d.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allRowCrossRefs",["isSelected","selectionIndex"]);for(a=0;a<f.length;a++)if(d=f[a],k=void 0,l=!1,k!==d.selectionIndex||l!==d.isSelected)d.selectionIndex=k,d.isSelected=l,this.setDirty("allColumnCrossRefs",d.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allColumnCrossRefs",
["isSelected","selectionIndex"])};
MatrixModel.prototype.__onColumnSelections_shortcutLoops=function(a){for(var b=this.get("hashEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("hashRowCrossRefs"),f=this.get("allColumnCrossRefs"),h=this.__rowIndexes(),g=this.__columnIndexes(this.__getDirtyState("columnSelections")),k=0;k<g.length;k++)for(var l=g[k],m=a[l],n=0<=m,p=0;p<h.length;p++){var q=h[p],q=q+":"+l;b.hasOwnProperty(q)&&(q=b[q],m!==q.selectionIndex||n!==q.isSelected)&&(q.selectionIndex=m,q.isSelected=
n,this.setDirty("allEntries",q.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allEntries",["isSelected","selectionIndex"]))}for(q=0;q<c.length;q++)if(p=c[q],m=void 0,n=!1,m!==p.selectionIndex||n!==p.isSelected)p.selectionIndex=m,p.isSelected=n,this.setDirty("allRowElements",p.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allRowElements",["isSelected","selectionIndex"]);for(k=0;k<g.length;k++)if(l=g[k],p=d[l],m=a[l],n=0<=m,m!==p.selectionIndex||n!==p.isSelected)p.selectionIndex=
m,p.isSelected=n,this.setDirty("allColumnElements",p.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allColumnElements",["isSelected","selectionIndex"]);for(k=0;k<g.length;k++)for(l=g[k],m=a[l],n=0<=m,p=0;p<h.length;p++)if(q=h[p],q=q+":"+l,e.hasOwnProperty(q)&&(c=e[q],m!==c.selectionIndex||n!==c.isSelected))c.selectionIndex=m,c.isSelected=n,this.setDirty("allRowCrossRefs",c.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allRowCrossRefs",["isSelected","selectionIndex"]);for(a=
0;a<f.length;a++)if(c=f[a],m=void 0,n=!1,m!==c.selectionIndex||n!==c.isSelected)c.selectionIndex=m,c.isSelected=n,this.setDirty("allColumnCrossRefs",c.key,["isSelected","selectionIndex"]),this.__setDirtyModel("allColumnCrossRefs",["isSelected","selectionIndex"])};
MatrixModel.prototype.__updateHighlights=function(){if(this.__isDirtyState("rowHighlights")||this.__isDirtyState("columnHighlights")||this.__isDirtyState("entryHighlights")||this.__isDirtyModel("allColumnElements",["rowHighlights","isSeleted","selectionIndex"])){var a=this.state.get("rowHighlights"),b=this.state.get("columnHighlights"),c=this.state.get("entryHighlights"),a=_.keys(a).map(function(a){return parseInt(a)})[0],b=_.keys(b).map(function(a){return parseInt(a)})[0],c=_.keys(c)[0];void 0!==
a?this.__onRowHighlights_shortcutLoops(a):void 0!==b?this.__onColumnHighlights_exhaustiveLoops(b):void 0!==c?this.__onEntryHighlights_shortcutLoops(c):this.__onNoHighlights_exhaustiveLoops()}};
MatrixModel.prototype.__onRowHighlights_exhaustiveLoops=function(a){var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("allRowCrossRefs"),f=this.get("allColumnCrossRefs"),h=c[a],g=void 0;h.isSelected&&(g=h.selectionIndex);g!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",g),this.setDirty("highlightSelectionIndex"));for(g=0;g<b.length;g++){var k=b[g],h=k.rowIndex===a;h!==k.isHighlighted&&(k.isHighlighted=h,this.setDirty("allEntries",
k.key,"isHighlighted"),this.__setDirtyModel("allEntries","isHighlighted"))}for(g=0;g<c.length;g++)b=c[g],h=g===a,h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allRowElements",b.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(c=0;c<d.length;c++)b=d[c],h=!1,h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allColumnElements",b.key,"isHighlighted"),this.__setDirtyModel("allColumnElements","isHighlighted"));for(c=0;c<e.length;c++)d=e[c],h=!1,h!==d.isHighlighted&&
(d.isHighlighted=h,this.setDirty("AllRowCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"));for(e=0;e<f.length;e++)d=f[e],h=d.rowIndex===a,h!==d.isHighlighted&&(d.isHighlighted=h,this.setDirty("allColumnCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs","isHighlighted"))};
MatrixModel.prototype.__onRowHighlights_shortcutLoops=function(a){var b=this.get("hashEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("allRowCrossRefs"),f=this.get("hashColumnCrossRefs"),h=c[a],g=void 0;h.isSelected&&(g=h.selectionIndex);g!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",g),this.setDirty("highlightSelectionIndex"));for(var h=this.__rowIndexes(this.__getDirtyState("rowHighlights")),g=this.__columnIndexes(),k=0;k<h.length;k++)for(var l=
h[k],m=l===a,n=0;n<g.length;n++){var p=g[n],p=l+":"+p;b.hasOwnProperty(p)&&(p=b[p],m!==p.isHighlighted&&(p.isHighlighted=m,this.setDirty("allEntries",p.key,"isHighlighted"),this.__setDirtyModel("allEntries","isHighlighted")))}for(k=0;k<h.length;k++)l=h[k],m=l===a,b=c[l],m!==b.isHighlighted&&(b.isHighlighted=m,this.setDirty("allRowElements",b.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(p=0;p<d.length;p++)b=d[p],m=!1,m!==b.isHighlighted&&(b.isHighlighted=m,this.setDirty("allColumnElements",
b.key,"isHighlighted"),this.__setDirtyModel("allColumnElements","isHighlighted"));for(d=0;d<e.length;d++)c=e[d],m=!1,m!==c.isHighlighted&&(c.isHighlighted=m,this.setDirty("AllRowCrossRefs",c.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"));for(k=0;k<h.length;k++)for(l=h[k],m=l===a,n=0;n<g.length;n++)p=g[n],p=l+":"+p,f.hasOwnProperty(p)&&(c=f[p],m!==c.isHighlighted&&(c.isHighlighted=m,this.setDirty("allColumnCrossRefs",c.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs",
"isHighlighted")))};
MatrixModel.prototype.__onColumnHighlights_exhaustiveLoops=function(a){var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("allRowCrossRefs"),f=this.get("allColumnCrossRefs"),h=d[a],g=h.rowHighlights,k=void 0;h.isSelected&&(k=h.selectionIndex);k!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",k),this.setDirty("highlightSelectionIndex"));for(k=0;k<b.length;k++){var l=b[k],h=g.hasOwnProperty(l.rowIndex)||l.columnIndex===a;h!==
l.isHighlighted&&(l.isHighlighted=h,this.setDirty("allEntries",l.key,"isHighlighted"),this.__setDirtyModel("allEntries","isHighlighted"))}for(k=0;k<c.length;k++)b=c[k],h=g.hasOwnProperty(k),h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allRowElements",b.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(c=0;c<d.length;c++)b=d[c],h=c===a,h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allColumnElements",b.key,"isHighlighted"),this.__setDirtyModel("allColumnElements",
"isHighlighted"));for(c=0;c<e.length;c++)d=e[c],h=d.columnIndex===a,h!==d.isHighlighted&&(d.isHighlighted=h,this.setDirty("allRowCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"));for(a=0;a<f.length;a++)d=f[a],h=g.hasOwnProperty(d.rowIndex),h!==d.isHighlighted&&(d.isHighlighted=h,this.setDirty("allColumnCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs","isHighlighted"))};
MatrixModel.prototype.__onEntryHighlights_exhaustiveLoops=function(a){var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("allRowCrossRefs"),f=this.get("allColumnCrossRefs"),h=a.split(":"),g=parseInt(h[0]),k=parseInt(h[1]),h=d[k],l=void 0;h.isSelected&&(l=h.selectionIndex);l!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",l),this.setDirty("highlightSelectionIndex"));for(l=0;l<b.length;l++){var m=b[l],h=m.key===a;h!==m.isHighlighted&&
(m.isHighlighted=h,this.setDirty("allEntries",m.key,"isHighlighted"),this.__setDirtyModel("allEntries","isHighlighted"))}for(l=0;l<c.length;l++)b=c[l],h=l===g,h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allRowElements",b.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(c=0;c<d.length;c++)b=d[c],h=c===k,h!==b.isHighlighted&&(b.isHighlighted=h,this.setDirty("allColumnElements",b.key,"isHighlighted"),this.__setDirtyModel("allColumnElements","isHighlighted"));
for(c=0;c<e.length;c++)d=e[c],h=d.key===a,h!==d.isHighlighted&&(d.isHighlighted=h,this.setDirty("allRowCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"));for(e=0;e<f.length;e++)d=f[e],h=d.key===a,h!==d.isHighlighted&&(d.isHighlighted=h,this.setDirty("allColumnCrossRefs",d.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs","isHighlighted"))};
MatrixModel.prototype.__onEntryHighlights_shortcutLoops=function(a){var b=this.get("hashEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.get("hashRowCrossRefs"),f=this.get("hashColumnCrossRefs"),h=a.split(":"),g=parseInt(h[0]),h=parseInt(h[1]),k=d[h],l=void 0;k.isSelected&&(l=k.selectionIndex);l!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",l),this.setDirty("highlightSelectionIndex"));var k=this.__getDirtyState("entryHighlights"),m;for(m in k)k=
m.split(":"),l=k[0],l=k[1],k=m===a,b.hasOwnProperty(m)&&(l=b[m],k!==l.isHighlighted&&(l.isHighlighted=k,this.setDirty("allEntries",l.key,"isHighlighted"),this.__setDirtyModel("allEntries","isHighlighted"))),e.hasOwnProperty(m)&&(l=e[m],k!==l.isHighlighted&&(l.isHighlighted=k,this.setDirty("allRowCrossRefs",l.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"))),f.hasOwnProperty(m)&&(l=allColumnCrossRefs[m],k!==l.isHighlighted&&(l.isHighlighted=k,this.setDirty("allColumnCrossRefs",
l.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs","isHighlighted")));for(l=0;l<c.length;l++)a=c[l],k=l===g,k!==a.isHighlighted&&(a.isHighlighted=k,this.setDirty("allRowElements",a.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(l=0;l<d.length;l++)a=d[l],k=l===h,k!==a.isHighlighted&&(a.isHighlighted=k,this.setDirty("allColumnElements",a.key,"isHighlighted"),this.__setDirtyModel("allColumnElements","isHighlighted"))};
MatrixModel.prototype.__onNoHighlights_exhaustiveLoops=function(){var a=this.get("allEntries"),b=this.get("allRowElements"),c=this.get("allColumnElements"),d=this.get("allRowCrossRefs"),e=this.get("allColumnCrossRefs");void 0!==this.get("highlightSelectionIndex")&&(this.set("highlightSelectionIndex",void 0),this.setDirty("highlightSelectionIndex"));for(var f=0;f<a.length;f++){var h=a[f],g=!1;g!==h.isHighlighted&&(h.isHighlighted=g,this.setDirty("allEntries",h.key,"isHighlighted"),this.__setDirtyModel("allEntries",
"isHighlighted"))}for(f=0;f<b.length;f++)a=b[f],g=!1,g!==a.isHighlighted&&(a.isHighlighted=g,this.setDirty("allRowElements",a.key,"isHighlighted"),this.__setDirtyModel("allRowElements","isHighlighted"));for(b=0;b<c.length;b++)a=c[b],g=!1,g!==a.isHighlighted&&(a.isHighlighted=g,this.setDirty("allColumnElements",a.key,"isHighlighted"),this.__setDirtyModel("allColumnElements","isHighlighted"));for(b=0;b<d.length;b++)c=d[b],g=!1,g!==c.isHighlighted&&(c.isHighlighted=g,this.setDirty("allRowCrossRefs",
c.key,"isHighlighted"),this.__setDirtyModel("allRowCrossRefs","isHighlighted"));for(d=0;d<e.length;d++)c=e[d],g=!1,g!==c.isHighlighted&&(c.isHighlighted=g,this.setDirty("allColumnCrossRefs",c.key,"isHighlighted"),this.__setDirtyModel("allColumnCrossRefs","isHighlighted"))};
MatrixModel.prototype.__updateExpansions=function(){if(this.__isDirtyState("columnExpansions")){var a=this.state.get("columnExpansions"),a=_.keys(a).map(function(a){return parseInt(a)})[0];void 0!==a?this.__onColumnExpansions_exhaustiveLoops(a):this.__onNoExpansions_exhaustiveLoops()}};
MatrixModel.prototype.__onColumnExpansions_exhaustiveLoops=function(a){for(var b=this.get("allEntries"),c=this.get("allColumnElements"),d=this.get("allColumnCrossRefs"),e=0;e<b.length;e++){var f=b[e],h=f.columnIndex===a;h!==f.isExpanded&&(f.isExpanded=h,this.setDirty("allEntries",f.key,"isExpanded"),this.__setDirtyModel("allEntries","isExpanded"))}for(b=0;b<c.length;b++)e=c[b],h=b===a,h!==e.isExpanded&&(e.isExpanded=h,this.setDirty("allColumnElements",e.key,"isExpanded"),this.__setDirtyModel("allColumnElements",
"isExpanded"));for(c=0;c<d.length;c++)b=d[c],h=b.columnIndex===a,h!==b.isExpanded&&(b.isExpanded=h,this.setDirty("allColumnCrossRefs",b.key,"isExpanded"),this.__setDirtyModel("allColumnCrossRefs","isExpanded"))};
MatrixModel.prototype.__onNoExpansions_exhaustiveLoops=function(){for(var a=this.get("allEntries"),b=this.get("allColumnElements"),c=this.get("allColumnCrossRefs"),d=0;d<a.length;d++){var e=a[d],f=!1;f!==e.isExpanded&&(e.isExpanded=f,this.setDirty("allEntries",e.key,"isExpanded"),this.__setDirtyModel("allEntries","isExpanded"))}for(a=0;a<b.length;a++)d=b[a],f=!1,f!==d.isExpanded&&(d.isExpanded=f,this.setDirty("allColumnElements",d.key,"isExpanded"),this.__setDirtyModel("allColumnElements","isExpanded"));
for(b=0;b<c.length;b++)a=c[b],f=!1,f!==a.isExpanded&&(a.isExpanded=f,this.setDirty("allColumnCrossRefs",a.key,"isExpanded"),this.__setDirtyModel("allColumnCrossRefs","isExpanded"))};MatrixModel.prototype.__updateInclusionsAndExclusions=function(){if(this.__isDirtyState("rowInExclusions")){var a=this.state.get("rowInExclusions");this.__onRowInExclusions_exhaustiveLoops(a)}};
MatrixModel.prototype.__onRowInExclusions_exhaustiveLoops=function(a){for(var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allRowCrossRefs"),e=0;e<b.length;e++){var f=b[e],h=f.rowIndex,g=!0===a[h],k=!1===a[h];if(g!==f.isIncluded||k!==f.isExcluded)f.isIncluded=g,f.isExcluded=k,this.setDirty("allEntries",f.key,["isIncluded","isExcluded"]),this.__setDirtyModel("allEntries",["isIncluded","isExcluded"])}for(h=0;h<c.length;h++)if(b=c[h],g=!0===a[h],k=!1===a[h],g!==b.isIncluded||k!==
b.isExcluded)b.isIncluded=g,b.isExcluded=k,this.setDirty("allRowElements",b.key,["isIncluded","isExcluded"]),this.__setDirtyModel("allRowElements",["isIncluded","isExcluded"]);for(c=0;c<d.length;c++)if(b=d[c],h=b.rowIndex,g=!0===a[h],k=!1===a[h],g!==b.isIncluded||k!==b.isExcluded)b.isIncluded=g,b.isExcluded=k,this.setDirty("allRowCrossRefs",b.key,["isIncluded","isExcluded"]),this.__setDirtyModel("allRowCrossRefs",["isIncluded","isExcluded"])};
MatrixModel.prototype.__updatePromotionsAndDemotions=function(){if(this.__isDirtyState("entryProDemotions")){var a=this.state.get("entryProDemotions");this.__onEntryProDemotions_shortcutLoops(a)}};
MatrixModel.prototype.__onEntryProDemotions_shortcutLoops=function(a){for(var b=this.get("allEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.__zeros(c.length),f=this.__zeros(c.length),h=this.__zeros(d.length),g=this.__zeros(d.length),k=0;k<b.length;k++){var l=b[k],m=l.key,n=l.rowIndex,p=l.columnIndex,q=!0===a[m],r=!1===a[m];if(q!==l.isPromoted||r!==l.isDemoted)l.isPromoted=q,l.isDemoted=r,this.setDirty("allEntries",l.key,["isPromoted","isDemoted"]),this.__setDirtyModel("allEntries",
["isPromoted","isDemoted"]);!0===a[m]&&(e[n]++,h[p]++);!1===a[m]&&(f[n]++,g[p]++)}for(n=0;n<c.length;n++)if(a=c[n],e[n]!==a.numPromoted||f[n]!==a.numDemoted)a.numPromoted=e[n],a.numDemoted=f[n],this.setDirty("allRowElements",n,["numPromoted","numDemoted"]),this.__setDirtyModel("allRowElements",["numPromoted","numDemoted"]);for(p=0;p<d.length;p++)if(a=d[p],h[p]!==a.numPromoted||g[p]!==a.numDemoted)a.numPromoted=h[p],a.numDemoted=g[p],this.setDirty("allColumnElements",p,["numPromoted","numDemoted"]),
this.__setDirtyModel("allColumnElements",["numPromoted","numDemoted"])};
MatrixModel.prototype.__onEntryProDemotions_shortcutLoops=function(a){var b=this.get("hashEntries"),c=this.get("allRowElements"),d=this.get("allColumnElements"),e=this.__entryIndexes(this.__getDirtyState("entryProDemotions")),f=this.__zeros(c.length),h=this.__zeros(c.length),g=this.__zeros(d.length),k=this.__zeros(d.length),l;for(l in e){var m=e[l];if(b.hasOwnProperty(m)){var n=b[m],p=n.rowIndex,q=n.columnIndex,r=!0===a[m],m=!1===a[m];if(r!==n.isPromoted||m!==n.isDemoted)!n.isPromoted&&r&&(f[p]++,
g[q]++),n.isPromoted&&!r&&(f[p]--,g[q]--),!n.isDemoted&&m&&(h[p]++,k[q]++),n.isDemoted&&!m&&(h[p]--,k[q]--),n.isPromoted=r,n.isDemoted=m,this.setDirty("allEntries",n.key,["isPromoted","isDemoted"]),this.__setDirtyModel("allEntries",["isPromoted","isDemoted"])}}for(p=0;p<c.length;p++)if(a=c[p],0!==f[p]||0!==h[p])a.numPromoted=f[p]+(a.numPromoted||0),a.numDemoted=h[p]+(a.numDemoted||0),this.setDirty("allRowElements",p,["numPromoted","numDemoted"]),this.__setDirtyModel("allRowElements",["numPromoted",
"numDemoted"]);for(q=0;q<d.length;q++)if(a=d[q],0!==g[q]||0!==k[q])a.numPromoted=g[q]+(a.numPromoted||0),a.numDemoted=k[q]+(a.numDemoted||0),this.setDirty("allColumnElements",q,["numPromoted","numDemoted"]),this.__setDirtyModel("allColumnElements",["numPromoted","numDemoted"])};MatrixModel.prototype.__zeros=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};
MatrixModel.prototype.__updateTexts=function(){if(this.__isDirtyState("rowLabels"))for(var a=this.get("allRowElements"),b=this.state.get("rowLabels"),c=0;c<a.length;c++){var d=a[c],e=b[c];e!==d.text&&(d.text=e,this.setDirty("allRowElements",d.key,"text"),this.__setDirtyModel("allRowElements","text"))}if(this.__isDirtyState("columnLabels"))for(a=this.get("allColumnElements"),c=this.state.get("columnLabels"),b=0;b<a.length;b++)d=a[b],e=c[b],e!==d.text&&(d.text=e,this.setDirty("allColumnElements",d.key,
"text"),this.__setDirtyModel("allColumnElements","text"));if(this.__isDirtyModel("allColumnElements",["numVisibles","isSelected","numOrdered","numPromoted"]))for(a=this.get("allColumnElements"),this.state.get("columnNumVisibleRows"),b=0;b<a.length;b++)d=a[b],e=[],0<d.numVisibles&&e.push("visibility"),0<d.numOrdered&&e.push("ordering"),0<d.numPromoted&&e.push("promotions"),d.isSelected&&e.push("selection"),e=e.join(";"),e!==d.icons&&(d.icons=e,this.setDirty("allColumnElements",d.key,"icons"),this.__setDirtyModel("allColumnElements",
"icons"))};MatrixModel.prototype.__updateEntryValues=function(){if(this.__isDirtyState("normalization")||this.__isDirtyModel(["maxJointProbability","rowRescaleMultiplier","columnRescaleMultiplier"])||this.__isDirtyModel("allEntries",["relValue","rowRelValue","columnRelValue"])){var a=this.get("allEntries"),b=this.state.get("normalization"),c=this.get("maxJointProbability"),d=this.get("rowRescaleMultiplier"),e=this.get("columnRescaleMultiplier"),f=void 0;if("none"===b){for(b=0;b<a.length;b++){var f=a[b],h=f.relValue;
h!==f.value&&(f.value=h,this.setDirty("allEntries",f.key,"value"))}f=c}else if("row"===b){for(b=0;b<a.length;b++)f=a[b],h=f.rowRelValue,h!==f.value&&(f.value=h,this.setDirty("allEntries",f.key,"value"));f=c*d}else if("column"===b){for(b=0;b<a.length;b++)f=a[b],h=f.columnRelValue,h!==f.value&&(f.value=h,this.setDirty("allEntries",f.key,"value"));f=c*e}f!==this.get("maxValue")&&(this.set("maxValue",f),this.setDirty("maxValue"));this.__setDirtyModel("allEntries","value")}};
MatrixModel.prototype.__updateRowColumnValues=function(){if(this.__isDirtyState("normalization")||this.__isDirtyModel("maxRowMarginalProbability")||this.__isDirtyModel("allRowElements","relValue")){var a=this.state.get("normalization"),b=this.get("allRowElements"),c=this.get("maxRowMarginalProbability"),d=void 0;if("row"===a){for(var e=0;e<b.length;e++)a=b[e],d=1,d!==a.value&&(a.value=d,this.setDirty("allRowElements",a.key,"value"));d=1}else{for(e=0;e<b.length;e++)a=b[e],d=a.relValue,d!==a.value&&
(a.value=d,this.setDirty("allRowElements",a.key,"value"));d=c}d!==this.get("maxRowValue")&&(this.set("maxRowValue",d),this.setDirty("maxRowValue"));this.__setDirtyModel("allRowElements","value")}if(this.__isDirtyState("normalization")||this.__isDirtyModel("maxColumnMarginalProbability")||this.__isDirtyModel("allColumnElements","relValue")){a=this.state.get("normalization");b=this.get("allColumnElements");c=this.get("maxColumnMarginalProbability");d=void 0;if("column"==a){for(e=0;e<b.length;e++)a=
b[e],d=1,d!==a.value&&(a.value=d,this.setDirty("allColumnElements",a.key,"value"));d=1}else{for(e=0;e<b.length;e++)a=b[e],d=a.relValue,d!==a.value&&(a.value=d,this.setDirty("allColumnElements",a.key,"value"));d=c}d!==this.get("maxColumnValue")&&(this.set("maxColumnValue",d),this.setDirty("maxColumnValue"));this.__setDirtyModel("allColumnElements","value")}};
MatrixModel.prototype.__updateCrossRefValues=function(){if(this.__isDirtyState("normalization")||this.__isDirtyState("allEntries",["relValue","rowRelValue"])||this.__isDirtyModel("allRowCrossRefs",["isSelected","isHighlighted","isVisible"])){var a=this.state.get("normalization"),b=this.get("allRowCrossRefs");if("row"===a)for(var c=0;c<b.length;c++){var a=b[c],d=(a.isSelected||a.isHighlighted)&&a.isVisible?a.entry.rowRelValue:0;d!==a.value&&(a.value=d,this.setDirty("allRowCrossRefs",a.key,"value"))}else for(c=
0;c<b.length;c++)a=b[c],d=(a.isSelected||a.isHighlighted)&&a.isVisible?a.entry.relValue:0,d!==a.value&&(a.value=d,this.setDirty("allRowCrossRefs",a.key,"value"));this.__setDirtyModel("allRowCrossRefs","value")}if(this.__isDirtyState("normalization")||this.__isDirtyState("allEntries",["relValue","columnRelValue"])||this.__isDirtyModel("allColumnCrossRefs",["isSelected","isHighlighted","isVisible"])){a=this.state.get("normalization");b=this.get("allColumnCrossRefs");if("column"===a)for(c=0;c<b.length;c++)a=
b[c],d=(a.isSelected||a.isHighlighted)&&a.isVisible?a.entry.columnRelValue:0,d!==a.value&&(a.value=d,this.setDirty("allColumnCrossRefs",a.key,"value"));else for(c=0;c<b.length;c++)a=b[c],d=(a.isSelected||a.isHighlighted)&&a.isVisible?a.entry.relValue:0,d!==a.value&&(a.value=d,this.setDirty("allColumnCrossRefs",a.key,"value"));this.__setDirtyModel("allColumnCrossRefs","value")}};
MatrixModel.prototype.__updateCrossRefPositionsAndSizes=function(){if(this.__isDirtyState("columnUserDefinedOrdering")||this.__isDirtyModel("allRowCrossRefs","value")){for(var a=this.state.get("columnUserDefinedOrdering"),b=this.get("allRowElements"),c=0;c<b.length;c++)for(var d=b[c],e=0,f=0;f<a.length;f++){var h=a[f];if(d.crossRefs.hasOwnProperty(h)){var g=d.crossRefs[h],k=e,l=e+=g.value;if(k!==g.startValue||l!==g.endValue)g.startValue=k,g.endValue=l,this.setDirty("allRowCrossRefs",g.key,["startValue",
"endValue"])}}this.__setDirtyModel("allRowCrossRefs",["startValue","endValue"])}if(this.__isDirtyState("rowUserDefinedOrdering")||this.__isDirtyModel("allColumnCrossRefs","value")){a=this.state.get("rowUserDefinedOrdering");b=this.get("allColumnElements");for(h=0;h<b.length;h++)for(d=b[h],f=e=0;f<a.length;f++)if(c=a[f],d.crossRefs.hasOwnProperty(c)&&(g=d.crossRefs[c],k=e,l=e+=g.value,k!==g.startValue||l!==g.endValue))g.startValue=k,g.endValue=l,this.setDirty("allColumnCrossRefs",g.key,["startValue",
"endValue"]);this.__setDirtyModel("allColumnCrossRefs",["startValue","endValue"])}};MatrixModel.prototype.__updateVisibilities=function(){var a=function(){for(var a=0;a<k.length;a++){var b=k[a];q[a]=b.isAdmitted&&!b.isExcluded||!b.isAdmitted&&b.isIncluded}for(a=0;a<l.length;a++)b=l[a],r[a]=b.isAdmitted&&!b.isExcluded||!b.isAdmitted&&b.isIncluded}.bind(this),b=function(){for(var a=this.get("globalRowRankingIndexes"),b=this.get("globalRowQuantileIndexes"),c=this.state.get("globalVisibleRowCount"),d=this.state.get("globalVisibleRowQuantile"),e=0;e<c&&e<a.length;e++)q[a[e]]=!0;for(e=
0;e<d;e++)for(a=0;a<b[e].length;a++)q[b[e][a]]=!0}.bind(this),c=function(){for(var a=this.state.get("columnVisibleRowCounts"),b=this.state.get("columnVisibleRowQuantiles"),c=0;c<l.length;c++){for(var d=l[c],e=0,f=a.hasOwnProperty(c)?a[c]:0,g=d.rowRankingIndexes,h=0;h<f&&h<g.length;h++)q[g[h]]=!0,e++;for(var g=b.hasOwnProperty(c)?b[c]:0,k=d.rowQuantileIndexes,h=0;h<g;h++)for(var m=0;m<k[h].length;m++)q[k[h][m]]=!0,e++;e!==d.numVisibles&&(d.numVisibles=e,this.setDirty("allColumnElements",d.key,"numVisibles"),
this.__setDirtyModel("allColumnElements","numVisibles"));f!==d.visibleRowCount&&(d.visibleRowCount=f,this.setDirty("allColumnElements",d.key,"visibleRowCount"),this.__setDirtyModel("allColumnElements","visibleRowCount"));g!==d.visibleRowQuantile&&(d.visibleRowQuantile=g,this.setDirty("allColumnElements",d.key,"visibleRowQuantile"),this.__setDirtyModel("allColumnElements","visibleRowQuantile"))}}.bind(this),d=function(){var a=this.state.get("columnSelections"),b=this.state.get("selectionVisibleRowCounts"),
c=this.state.get("selectionVisibleRowQuantiles"),d;for(d in a){for(var e=a[d],f=l[d],g=p[e],h=0,k=b.hasOwnProperty(e)?b[e]:0,m=f.rowRankingIndexes,n=0;n<k&&n<m.length;n++)q[m[n]]=!0,h++;e=c.hasOwnProperty(e)?c[e]:0;f=f.rowQuantileIndexes;for(n=0;n<e;n++)for(m=0;m<f[n].length;m++)q[f[n][m]]=!0,h++;h!==g.numVisibles&&(g.numVisibles=h,this.setDirty("allSelectionGroups",g.key,"numVisibles"),this.__setDirtyModel("allSelectionGroups","numVisibles"));k!==g.visibleRowCount&&(g.visibleRowCount=k,this.setDirty("allSelectionGroups",
g.key,"visibleRowCount"),this.__setDirtyModel("allSelectionGroups","visibleRowCount"));e!==g.visibleRowQuantile&&(g.visibleRowQuantile=e,this.setDirty("allSelectionGroups",g.key,"visibleRowQuantile"),this.__setDirtyModel("allSelectionGroups","visibleRowQuantile"))}}.bind(this),e=function(){var a=this.state.get("columnExpansions"),b=this.state.get("columnVisibleRowCounts"),c=this.state.get("columnVisibleRowQuantiles"),d=this.state.get("expansionVisibleRowCount"),e=this.state.get("expansionVisibleRowQuantile"),
f;for(f in a){for(var g=l[f],a=0,h=b.hasOwnProperty(f)?b[f]:d,k=g.rowRankingIndexes,m=0;m<h&&m<k.length;m++)q[k[m]]=!0,a++;h=c.hasOwnProperty(f)?c[f]:e;g=g.rowQuantileIndexes;for(m=0;m<h;m++)for(k=0;k<g[m].length;k++)q[g[m][k]]=!0,a++}}.bind(this),f=function(){for(var a=0;a<k.length;a++)0<k[a].numPromoted&&(q[a]=!0)}.bind(this),h=function(){var a=this.state.get("rowUserDefinedVisibilities"),b;for(b in a)q[b]=a[b]}.bind(this),g=this.get("allEntries"),k=this.get("allRowElements"),l=this.get("allColumnElements"),
m=this.get("allRowCrossRefs"),n=this.get("allColumnCrossRefs"),p=this.get("allSelectionGroups"),q=Array(k.length),r=Array(l.length);a();b();c();e();d();f();h();for(e=0;e<g.length;e++)f=g[e],a=f.rowIndex,b=f.columnIndex,c=!0===f.isVisible,d=q[a]&&r[b],f.isEnter=!c&&d,f.isStay=c&&d,f.isExit=c&&!d,d!==f.isVisible&&(f.isVisible=d,this.setDirty("allEntries",f.key,"isVisible"),this.__setDirtyModel("allEntries","isVisible"));for(a=0;a<k.length;a++)g=k[a],c=!0===g.isVisible,d=q[a],g.isEnter=!c&&d,g.isStay=
c&&d,g.isExit=c&&!d,d!==g.isVisible&&(g.isVisible=d,this.setDirty("allRowElements",g.key,"isVisible"),this.__setDirtyModel("allRowElements","isVisible"));for(b=0;b<l.length;b++)g=l[b],c=!0===g.isVisible,d=r[b],g.isEnter=!c&&d,g.isStay=c&&d,g.isExit=c&&!d,d!==g.isVisible&&(g.isVisible=d,this.setDirty("allColumnElements",g.key,"isVisible"),this.__setDirtyModel("allColumnElements","isVisible"));for(e=0;e<m.length;e++)g=m[e],c=!0===g.isVisible,a=g.rowIndex,b=g.columnIndex,d=q[a]&&r[b],g.isEnter=!c&&d,
g.isStay=c&&d,g.isExit=c&&!d,d!==g.isVisible&&(g.isVisible=d,this.setDirty("allRowCrossRefs",g.key,"isVisible"),this.__setDirtyModel("allRowCrossRefs","isVisible"));for(m=0;m<n.length;m++)g=n[m],c=!0===g.isVisible,a=g.rowIndex,b=g.columnIndex,d=q[a]&&r[b],g.isEnter=!c&&d,g.isStay=c&&d,g.isExit=c&&!d,d!==g.isVisible&&(g.isVisible=d,this.setDirty("allColumnCrossRefs",g.key,"isVisible"),this.__setDirtyModel("allColumnCrossRefs","isVisible"));this.__setDirtyModel("allEntries",["isEnter","isStay","isExit"]);
this.__setDirtyModel("allRowElements",["isEnter","isStay","isExit"]);this.__setDirtyModel("allColumnElements",["isEnter","isStay","isExit"]);this.__setDirtyModel("allRowCrossRefs",["isEnter","isStay","isExit"]);this.__setDirtyModel("allColumnCrossRefs",["isEnter","isStay","isExit"])};var MatrixSelections=MatrixInteractions.extend({el:"div.MatrixSelections"});MatrixSelections.prototype.initialize=function(a){MatrixInteractions.prototype.initialize.call(this,a);this.model=a.model;this.state=this.model.state;this.$el.addClass("MatrixView");this.__container=d3.select(this.el).append("div").attr("class","container");this.__selectionPanel=this.__container.append("div").style("position","static");this.listenTo(this.model,"dirty",this.__onModelEvents)};
MatrixSelections.prototype.__isDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__isDirty__(this.__currentModelEvents,a,0)};MatrixSelections.prototype.__getDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__getDirty__(this.__currentModelEvents,a,0)};MatrixSelections.prototype.__onModelEvents=function(a){this.__currentModelEvents=a;this.__isDirtyModel("allSelectionGroups")&&this.__renderSelectionGroups()};
MatrixSelections.prototype.__renderSelectionGroups=function(){function a(a){a.style("width","120px").style("min-height","100px").style("padding","5px")}function b(a){a.style("position","static").style("display","inline-block").style("width","118px").style("min-height","50px").style("margin-top",function(a,b){return 0===b?null:"5px"}).style("border-width","1px").style("border-style","solid").style("border-color",function(a){return a.color}).style("background",function(a){return a.background}).call(this.mouseListeners.bind(this)).call(this.dragdropListeners.bind(this));
a.append("div").attr("class","selection").style("width","16px").style("padding","3px").style("pointer-events","auto").style("cursor","pointer").append("i").attr("class",this.CONST.ICONS.SELECTION).style("color",function(a){return a.color}).style("font-size",2*this.CONST.FONT_SIZE_PT+"pt");a.append("input").attr("class","title").attr("type","text").style("margin","0 2px").style("width","90px").style("border-width","2px").style("border-style","dotted").style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("cursor",
"text").style("pointer-events","auto").on("mouseover",function(a){d3.select(d3.event.srcElement).style("border-color",a.color)}.bind(this)).on("mouseout",function(a){d3.select(d3.event.srcElement).style("border-color",a.background)}.bind(this)).on("focus",function(a){d3.select(d3.event.srcElement).style("background","#fff")}.bind(this)).on("blur",function(a){d3.select(d3.event.srcElement).style("background",a.background)}.bind(this)).on("keydown",function(){d3.event.cancelBubble=!0}).on("change",
h.bind(this));var b=a.append("div").attr("class","visibility").style("width","100px").style("padding","3px 5px 0 5px");b.append("div").append("i").attr("class",this.CONST.ICONS.VISIBILITY).style("padding","0 3px").style("color",function(a){return a.color}).style("font-size",this.CONST.FONT_SIZE_PT+"pt");b.append("div").append("input").attr("type","range").attr("min",c.bind(this)).attr("max",d.bind(this)).attr("value",e.bind(this)).style("width","80px").style("opacity",0.3).style("vertical-align",
"-5px").style("cursor","pointer").style("pointer-events","auto").on("mouseover",function(){d3.select(d3.event.srcElement).transition().style("opacity",1)}).on("mouseout",function(){d3.select(d3.event.srcElement).transition().style("opacity",0.3)}).on("change",f.bind(this));a=a.append("div").attr("class","ordering").style("width","100px").style("padding","0 5px 3px 5px");a.append("div").append("i").attr("class",this.CONST.ICONS.ORDERING).style("padding","0 3px").style("color",function(a){return a.color}).style("font-size",
this.CONST.FONT_SIZE_PT+"pt");a.append("div").append("input").attr("type","range").style("width","80px").style("vertical-align","-5px").style("opacity",0.1)}function c(a){return this.state.CONST.MIN_VISIBLE_ROW_QUANTILES}function d(a){return this.state.CONST.MAX_VISIBLE_ROW_QUANTILES}function e(a){return a.visibleRowQuantile}function f(a){this.state.selectionVisibleRowQuantiles(a.selectionIndex,parseInt(d3.event.srcElement.value));d3.event.srcElement.blur()}function h(a){this.state.selectionLabels(a.selectionIndex,
d3.event.srcElement.value);d3.event.srcElement.blur()}var g=this.model.get("allSelectionGroups");!0===this.__getDirtyModel("allSelectionGroups")&&(this.__selectionPanel.call(a.bind(this)),g=this.__selectionPanel.selectAll("div.selectionGroup").data(g),g.enter().append("div").attr("class","selectionGroup").call(b.bind(this)),g.exit().remove());this.__selectionPanel.selectAll("div.selectionGroup").call(function(a){}.bind(this)).transition().call(function(a){a.select("input.title").style("color",function(a){return a.color}).style("background",
function(a){return a.background}).style("border-color",function(a){return a.background}).attr("value",function(a){return a.text})}.bind(this))};MatrixSelections.prototype.__onUpdateSelectionIndex=function(){var a=this.model.get("ui:selectionIndex");this.__selectionColors.style("margin",function(b){return b.index===a?"0px":"1px"}).style("border-width",function(b){return b.index===a?"2px":"1px"}).style("opacity",function(b){return b.index===a?1:0.5})};var MatrixView=MatrixInteractions.extend({el:"div.MatrixView"});MatrixView.prototype.initialize=function(a){MatrixInteractions.prototype.initialize.call(this,a);this.__defineHtmlElements();this.__initModelEvents()};
MatrixView.prototype.CONST=_.extend(_.clone(MatrixInteractions.prototype.CONST),{LEFT_PANEL_WIDTH:90,TOP_PANEL_HEIGHT:70,RIGHT_PANEL_WIDTH:100,BOTTOM_PANEL_HEIGHT:100,BOTTOM_BAR_MAX_LENGTH:75,FAR_PANEL_WIDTH:125,FAR_BAR_MAX_LENGTH:120,LEFT_PADDING:8,TOP_PADDING:8,RIGHT_PADDING:5,BOTTOM_PADDING:5,FAR_PADDING:8,OUTER_PADDING:20,EXPANSION_SPACING:210,EXPANSION_OFFSET:30,EXPANSION_WIDTH:135,MAX_RADIUS_PX:20,SPACING_PX:13.5,BAR_WIDTH_PX:10.5,TOP_LABEL_ANGLE_DEG:-65});
MatrixView.prototype.__initModelEvents=function(){this.__isRendering=!1;this.__pendingModelEvents={};this.__currentModelEvents={};this.__ongoingModelEvents={};this.__rescheduleViewRendering=_.debounce(this.__scheduleViewRendering,20);this.listenTo(this.model,"dirty",this.__onModelEvents)};MatrixView.prototype.__onModelEvents=function(a){this.__pendingModelEvents=this.__combineDirty__(this.__pendingModelEvents,a);this.__scheduleViewRendering()};
MatrixView.prototype.__scheduleViewRendering=function(){this.__isRendering&&this.__rescheduleViewRendering();this.__isRendering=!0;this.__currentModelEvents=this.__pendingModelEvents;this.__pendingModelEvents={};this.__currentModelEvents=this.__combineDirty__(this.__currentModelEvents,this.__ongoingModelEvents);this.__ongoingModelEvents={};this.__renderView();this.triggerDirty();this.__clearModelEvents();this.__isRendering=!1};
MatrixView.prototype.__isDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__isDirty__(this.__currentModelEvents,a,0)};MatrixView.prototype.__getDirtyModel=function(){var a=Array.prototype.slice.call(arguments);return this.__getDirty__(this.__currentModelEvents,a,0)};
MatrixView.prototype.__clearModelEvents=function(){this.__ongoingModelEvents=this.__combineDirty__(this.__ongoingModelEvents,this.__currentModelEvents);var a=this.model.get("vis:schedules").duration;d3.timer(function(){this.__ongoingModelEvents={};return!0}.bind(this),a)};
MatrixView.prototype.__renderView=function(){this.__calculateChartWidthAndColumnLayouts();this.__calculateChartHeightAndRowLayouts();this.__calculateSizes();this.__calculateDimensions();this.__resetElements();this.__renderElements();this.__resizeLayers();this.__resizeContainerAndDepths()};MatrixView.prototype.__defineHtmlElements=function(){this.__selections=[];this.__scales={};this.__defineContainerAndDepths();this.__defineLayers();this.__defineElements()};
MatrixView.prototype.__defineContainerAndDepths=function(){this.$el.addClass("MatrixView");this.__container=d3.select(this.el).append("div").attr("class","container");this.__canvas=this.__container.append("div").attr("class","canvas");this.__depths={};this.__depths.catcher=this.__canvas.append("div").attr("class","catcherLayer").attr("z-index",-20);this.__depths.svg=this.__canvas.append("svg:svg").attr("class","svgLayer").attr("z-index",-10);this.__depths.html=this.__canvas.append("div").attr("class",
"htmlLayer").attr("z-index",0);this.__depths.overlay=this.__canvas.append("svg:svg").attr("class","overlayLayer").attr("z-index",10)};
MatrixView.prototype.__defineLayers=function(){function a(a,b){return{width:a,height:b,x:this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING,y:this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING}}function b(a,b){return{width:a,height:this.CONST.TOP_PANEL_HEIGHT,x:this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING,y:this.CONST.OUTER_PADDING}}function c(a,b){a.style("left",b.x+"px").style("top",b.y+"px").style("width",b.width+
"px").style("height",b.height+"px")}function d(a,b){a.attr("transform","translate("+b.x+","+b.y+")").attr("width",b.width).attr("height",b.height)}this.__layers={};this.__layers.centerCatcher={content:this.__depths.catcher.append("div").attr("class","centerCatcher"),dims:a,renderer:c};this.__layers.centerGrids={content:this.__depths.svg.append("svg:g").attr("class","centerGrids"),dims:a,renderer:d};this.__layers.centerControls={content:this.__depths.html.append("div").attr("class","centerControls"),
dims:a,renderer:c};this.__layers.centerPanel={content:this.__depths.overlay.append("svg:g").attr("class","centerPanel"),dims:a,renderer:d};this.__layers.leftPanel={content:this.__depths.html.append("div").attr("class","leftPanel"),dims:function(a,b){return{width:this.CONST.LEFT_PANEL_WIDTH,height:b,x:this.CONST.OUTER_PADDING,y:this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING}},renderer:c};this.__layers.topCatcher={content:this.__depths.catcher.append("div").attr("class",
"topPanel"),dims:b,renderer:c};this.__layers.topPanel={content:this.__depths.html.append("div").attr("class","topPanel"),dims:b,renderer:c};this.__layers.rightPanel={content:this.__depths.html.append("div").attr("class","rightPanel"),dims:function(a,b){return{width:this.CONST.RIGHT_PANEL_WIDTH,height:b,x:this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING+a+this.CONST.RIGHT_PADDING,y:this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING}},renderer:c};
this.__layers.bottomPanel={content:this.__depths.svg.append("svg:g").attr("class","bottomPanel"),dims:function(a,b){return{width:a,height:this.CONST.BOTTOM_PANEL_HEIGHT,x:this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING,y:this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING+b+this.CONST.BOTTOM_PADDING}},renderer:d};this.__layers.farPanel={content:this.__depths.svg.append("svg:g").attr("class","farPanel"),dims:function(a,b){return{width:this.CONST.FAR_PANEL_WIDTH,
height:b,x:this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING+a+this.CONST.RIGHT_PADDING+this.CONST.RIGHT_PANEL_WIDTH+this.CONST.FAR_PADDING,y:this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING}},renderer:d}};
MatrixView.prototype.__defineElements=function(){this.__elements=[];var a=function(a){return this.__scales.xSpatial(a.columnPosition+0.5)}.bind(this),b=function(a){return this.__scales.ySpatial(a.rowPosition+0.5)}.bind(this),c=function(a){return this.__scales.xSpatial(a.columnPosition+1)-this.__scales.xSpatial(a.columnPosition)}.bind(this),d=function(a){return function(){return this.__scales.xSpatial(0<a?a:this.__scales.columnDims+a)}.bind(this)}.bind(this),e=function(a){return function(){return this.__scales.ySpatial(0<
a?a:this.__scales.rowDims+a)}.bind(this)}.bind(this);this.__elements.push({identifier:"div.yCatcher",layer:this.__layers.centerCatcher,dataID:"transitionColumnElements",renderers:{initRenderer:function(a){a.style("top","0px")},updateAnimations:function(b){b.style("left",a).style("width",c).style("height",this.__scales.chartHeight+"px")},mouse:this.mouseListeners}});this.__elements.push({identifier:"line.xGridlines",layer:this.__layers.centerGrids,dataID:"transitionRowElements",renderers:{updateAnimations:function(a){a.attr("x1",
d(0.5)).attr("x2",d(-0.5)).attr("y1",b).attr("y2",b).style("stroke",this.__getBackgroundColor.bind(this)).style("stroke-width",this.__getGridlineStrokeWidth.bind(this)).style("stroke-opacity",this.__getGridlineStrokeOpacity.bind(this))}}});this.__elements.push({identifier:"line.yGridlines",layer:this.__layers.centerGrids,dataID:"transitionColumnElements",renderers:{updateAnimations:function(b){b.attr("x1",a).attr("x2",a).attr("y1",e(0.5)).attr("y2",e(-0.5)).style("stroke",this.__getBackgroundColor.bind(this)).style("stroke-width",
this.__getGridlineStrokeWidth.bind(this)).style("stroke-opacity",this.__getGridlineStrokeOpacity.bind(this))}}});this.__elements.push({identifier:"circle.entries",layer:this.__layers.centerPanel,dataID:"transitionEntries",renderers:{updateAnimations:function(c){c.attr("cx",a).attr("cy",b).attr("r",function(a){return this.__scales.rSize(a.value)}.bind(this)).style("stroke",this.__getForegroundColor.bind(this)).style("stroke-width",this.__getCircleStrokeWidth.bind(this)).style("stroke-opacity",this.__getCircleStrokeOpacity.bind(this)).style("fill",
this.__getForegroundColor.bind(this)).style("fill-opacity",this.__getCircleFillOpacity.bind(this))},mouse:this.mouseListeners}});var f=function(a){return this.__scales.ySpatial(a.rowPosition+0.5)-0.5*this.CONST.SPACING_PX+"px"}.bind(this),h=function(a){return this.__scales.xSpatial(a.columnPosition+0.5)+this.__topLabelOffsetX+"px"}.bind(this);this.__elements.push({identifier:"div.rowTextsLeft",layer:this.__layers.leftPanel,dataID:"transitionRowElements",renderers:{initRenderer:function(a){a.style("left",
"0px").style("width",this.CONST.LEFT_PANEL_WIDTH+"px").style("height",this.CONST.SPACING_PX+"px").style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("text-align","right").style("white-space","nowrap")},updateAnimations:function(a){a.style("top",f).style("color",this.__getForegroundColor.bind(this)).style("font-weight",this.__getFontWeight.bind(this)).style("text-decoration",this.__getTextDecoration.bind(this)).text(function(a){return a.text})},mouse:this.mouseListeners,dragdrop:this.dragdropListeners}});
this.__elements.push({identifier:"div.columnTexts",layer:this.__layers.topPanel,dataID:"transitionColumnElements",renderers:{initRenderer:function(a){a.style("top",this.CONST.TOP_PANEL_HEIGHT+this.__topLabelOffsetY+"px").style("width",this.__topLabelWidth+"px").style("height",this.__topLabelHeight+"px").style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("text-align","left").style("white-space","nowrap").style("-webkit-transform","rotate("+this.__topLabelAngle+"deg)").style("-moz-transform","rotate("+
this.__topLabelAngle+"deg)").style("-o-transform","rotate("+this.__topLabelAngle+"deg)").style("cursor","pointer");a.append("span").attr("class","text").style("position","static").style("pointer-events","none");a.append("span").attr("class","icons").style("position","static").style("pointer-events","none")},updateRenderer:function(a){a=a.select("span.icons").selectAll("i").data(function(a){return a.icons.split(";")});a.exit().remove();a.enter().append("i").style("padding-left","4px").style("position",
"static")},updateAnimations:function(a){a.style("left",h).style("color",this.__getForegroundColor.bind(this)).style("font-weight",this.__getFontWeight.bind(this)).style("text-decoration",this.__getTextDecoration.bind(this));a.select("span.text").text(function(a){return a.text});a.select("span.icons").selectAll("i").attr("class",function(a){return this.CONST.ICONS[a.toUpperCase()]}.bind(this))},mouse:this.mouseListeners,dragdrop:this.dragdropListeners}});this.__elements.push({identifier:"div.rowTextsRight",
layer:this.__layers.rightPanel,dataID:"transitionRowElements",renderers:{initRenderer:function(a){a.style("left","0px").style("width",this.CONST.RIGHT_PANEL_WIDTH+"px").style("height",this.CONST.SPACING_PX+"px").style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("text-align","right").style("white-space","nowrap")},updateAnimations:function(a){a.style("top",f).style("color",this.__getForegroundColor.bind(this)).style("font-weight",this.__getFontWeight.bind(this)).style("text-decoration",this.__getTextDecoration.bind(this)).text(function(a){return a.text})},
mouse:this.mouseListeners,dragdrop:this.dragdropListeners}});var g=function(a){return"translate(0,"+this.__scales.ySpatial(a.rowPosition+0.5)+")"}.bind(this),k=function(a){return"translate("+this.__scales.xSpatial(a.columnPosition+0.5)+",0)"}.bind(this);this.__elements.push({identifier:"line.rowTotals",layer:this.__layers.farPanel,dataID:"transitionRowElements",renderers:{initRenderer:function(a){a.attr("y1",0).attr("y2",0).style("stroke-width",this.CONST.BAR_WIDTH_PX)},updateAnimations:function(a){a.attr("transform",
g).attr("x1",this.__scales.xLength(0)).attr("x2",function(a){return this.__scales.xLength(a.value)}.bind(this)).style("stroke",this.__getBackgroundColor.bind(this)).style("stroke-opacity",this.__getTotalStrokeOpacity.bind(this))},mouse:this.mouseListeners}});this.__elements.push({identifier:"line.columnTotals",layer:this.__layers.bottomPanel,dataID:"transitionColumnElements",renderers:{initRenderer:function(a){a.attr("x1",0).attr("x2",0).style("stroke-width",this.CONST.BAR_WIDTH_PX)},updateAnimations:function(a){a.attr("transform",
k).attr("y1",this.__scales.yLength(0)).attr("y2",function(a){return this.__scales.yLength(a.value)}.bind(this)).style("stroke",this.__getBackgroundColor.bind(this)).style("stroke-opacity",this.__getTotalStrokeOpacity.bind(this))},mouse:this.mouseListeners}});this.__elements.push({identifier:"line.rowSubtotals",layer:this.__layers.farPanel,dataID:"transitionRowCrossRefs",renderers:{initRenderer:function(a){a.attr("y1",0).attr("y2",0).style("stroke-width",this.CONST.BAR_WIDTH_PX)},updateAnimations:function(a){a.attr("transform",
g);a.attr("x1",function(a){return this.__scales.xLength(a.startValue)}.bind(this)).attr("x2",function(a){return this.__scales.xLength(a.endValue)}.bind(this));a.style("stroke",this.__getForegroundColor.bind(this)).style("stroke-opacity",this.__getSubtotalStrokeOpacity.bind(this))},mouse:this.mouseListeners}});this.__elements.push({identifier:"line.columnSubtotals",layer:this.__layers.bottomPanel,dataID:"transitionColumnCrossRefs",renderers:{initRenderer:function(a){a.attr("x1",0).attr("x2",0).style("stroke-width",
this.CONST.BAR_WIDTH_PX)},updateAnimations:function(a){a.attr("transform",k);a.attr("y1",function(a){return this.__scales.yLength(a.startValue)}.bind(this)).attr("y2",function(a){return this.__scales.yLength(a.endValue)}.bind(this));a.style("stroke",this.__getForegroundColor.bind(this)).style("stroke-opacity",this.__getSubtotalStrokeOpacity.bind(this))},mouse:this.mouseListeners}});var l=function(a){return this.state.CONST.MIN_VISIBLE_ROW_QUANTILE}.bind(this),m=function(a){return this.state.CONST.MAX_VISIBLE_ROW_QUANTILE}.bind(this),
n=function(a){var b=this.state.get("columnVisibleRowQuantiles"),c=void 0;return c=b.hasOwnProperty(a.columnIndex)?b[a.columnIndex]:this.state.get("expansionVisibleRowQuantile")}.bind(this),p=function(a){return this.state.CONST.MIN_ORDERED_ROW_QUANTILE}.bind(this),q=function(a){return this.state.CONST.MAX_ORDERED_ROW_QUANTILE}.bind(this),r=function(a){var b=this.state.get("columnOrderedRowQuantiles"),c=void 0;return c=b.hasOwnProperty(a.columnIndex)?b[a.columnIndex]:this.state.get("expansionOrderedRowQuantile")}.bind(this),
x=function(a){this.state.columnLabels(a.columnIndex,d3.event.srcElement.value);d3.event.srcElement.blur()}.bind(this),v=function(a){var b=parseInt(d3.event.srcElement.value);this.state.columnVisibleRowQuantiles(a.columnIndex,b)}.bind(this),t=function(a){var b=parseInt(d3.event.srcElement.value);this.state.columnOrderedRowQuantiles(a.columnIndex,b)}.bind(this);this.__elements.push({identifier:"div.columnMetas",layer:this.__layers.topCatcher,dataID:"transitionColumnMetas",renderers:{initRenderer:function(a){a.style("top",
"0px").style("width",this.CONST.EXPANSION_SPACING+"px").style("height",this.CONST.TOP_PANEL_HEIGHT+"px");a.append("div").attr("class","columnText").style("left",this.CONST.EXPANSION_OFFSET+2.5*this.CONST.SPACING_PX+"px").style("top","0px").append("input").attr("type","text").style("color",this.CONST.DEFAULT_COLOR).style("border","2px dotted #fff").style("padding","2px").style("font-size",1.35*this.CONST.FONT_SIZE_PT+"pt").style("font-weight","bold").style("width",this.CONST.EXPANSION_WIDTH+"px").style("cursor",
"text").style("pointer-events","auto").on("mouseover",function(){d3.select(d3.event.srcElement).style("border-color",this.CONST.DEFAULT_COLOR)}.bind(this)).on("mouseout",function(){d3.select(d3.event.srcElement).style("border-color","#fff")}.bind(this)).on("focus",function(){d3.select(d3.event.srcElement).style("border-color","#fff")}.bind(this)).on("keydown",function(){d3.event.cancelBubble=!0}).on("change",x);var b=a.selectAll("div.visibility").data(function(a){return a.visibility}).enter().append("div").attr("class",
"visibility").style("left",this.CONST.EXPANSION_OFFSET+2.5*this.CONST.SPACING_PX+10+"px").style("top","30px").style("width","125px").style("height","16px").style("pointer-events","auto");b.append("div").append("i").attr("class",this.CONST.ICONS.VISIBILITY).style("color",this.CONST.DEFAULT_COLOR).style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("opacity",0.75);b.append("div").append("input").attr("type","range").attr("min",l).attr("max",m).attr("value",n).style("left","14px").style("top","-1px").style("width",
"90px").style("opacity",0.3).style("cursor","pointer").style("pointer-events","auto").on("mouseover",function(){d3.select(d3.event.srcElement).transition().style("opacity",1)}).on("mouseout",function(){d3.select(d3.event.srcElement).transition().style("opacity",0.3)}).on("change",v);a=a.selectAll("div.ordering").data(function(a){return a.ordering}).enter().append("div").attr("class","ordering").style("left",this.CONST.EXPANSION_OFFSET+2.5*this.CONST.SPACING_PX+10+"px").style("top","45px").style("width",
"125px").style("height","16px").style("pointer-events","auto");a.append("div").append("i").attr("class",this.CONST.ICONS.ORDERING).style("color",this.CONST.DEFAULT_COLOR).style("font-size",this.CONST.FONT_SIZE_PT+"pt").style("opacity",0.75);a.append("div").append("input").attr("type","range").attr("min",p).attr("max",q).attr("value",r).style("left","14px").style("top","-1px").style("width","90px").style("opacity",0.1).style("cursor","pointer").style("pointer-events","auto").on("mouseover",function(){d3.select(d3.event.srcElement).transition().style("opacity",
1)}).on("mouseout",function(){d3.select(d3.event.srcElement).transition().style("opacity",0.3)}).on("change",t)},updateAnimations:function(a){a.style("left",this.__scales.xSpatial(this.model.get("expansionColumnPosition"))+this.CONST.SPACING_PX+"px");a.select("div.columnText").select("input").each(function(a){d3.select(this)[0][0].value=a.element.text})},mouse:this.mouseListeners}});var w=function(a){a.isPromoted?this.state.entryPromotionsAndDemotions(a.rowIndex,a.columnIndex):this.state.entryPromotionsAndDemotions(a.rowIndex,
a.columnIndex,!0);d3.event.cancelBubble=!0}.bind(this),u=function(a){a.isDemoted?this.state.entryPromotionsAndDemotions(a.rowIndex,a.columnIndex):this.state.entryPromotionsAndDemotions(a.rowIndex,a.columnIndex,!1);d3.event.cancelBubble=!0}.bind(this),s=function(){d3.select(d3.event.srcElement).transition().style("color",this.CONST.DEFAULT_COLOR)}.bind(this),y=function(){d3.select(d3.event.srcElement).transition().style("color",this.CONST.DEFAULT_BACKGROUND)}.bind(this);this.__elements.push({identifier:"div.annotationBorder",
layer:this.__layers.centerControls,dataID:"transitionColumnMetas",renderers:{initRenderer:function(a){a.style("width",this.CONST.EXPANSION_WIDTH+0.5*this.CONST.SPACING_PX+"px").style("border","1px solid #ccc").style("box-shadow","0 0 10px #999").style("background","#fff")},updateAnimations:function(a){a.style("left",this.__scales.xSpatial(this.model.get("expansionColumnPosition"))+this.CONST.EXPANSION_OFFSET+2*this.CONST.SPACING_PX+"px").style("top",this.__scales.ySpatial(0)-0.5*this.CONST.SPACING_PX-
2+"px").style("height",function(a){return(this.model.get("visibleAnnotationDims")+1)*this.CONST.SPACING_PX+"px"}.bind(this))}}});this.__elements.push({identifier:"div.annotationItems",layer:this.__layers.centerControls,dataID:"transitionAnnotationControls",renderers:{initRenderer:function(a){a.style("height",this.CONST.SPACING_PX+"px").style("width",this.CONST.EXPANSION_WIDTH+"px").style("color",this.CONST.DEFAULT_COLOR);a.append("div").attr("class","promoteButton").style("left",function(a,b){return 0.5*
this.CONST.SPACING_PX+"px"}.bind(this)).style("width",1.25*this.CONST.SPACING_PX+"px").style("height",this.CONST.SPACING_PX+"px").style("color",this.CONST.DEFAULT_BACKGROUND).style("cursor","pointer").style("pointer-events","auto").on("click",w).on("mouseover",s).on("mouseout",y).append("i").style("pointer-events","none").style("left",0.125*this.CONST.SPACING_PX+"px").style("font-size",this.CONST.SPACING_PX+"px");a.append("div").attr("class","demoteButton").style("left",function(a,b){return 1.75*
this.CONST.SPACING_PX+"px"}.bind(this)).style("width",1.25*this.CONST.SPACING_PX+"px").style("height",this.CONST.SPACING_PX+"px").style("color",this.CONST.DEFAULT_BACKGROUND).style("cursor","pointer").style("pointer-events","auto").on("click",u).on("mouseover",s).on("mouseout",y).append("i").style("pointer-events","none").style("left",0.125*this.CONST.SPACING_PX+"px").style("font-size",this.CONST.SPACING_PX+"px");a.append("div").attr("class","rowText").style("left",3.25*this.CONST.SPACING_PX+"px").style("font-size",
this.CONST.FONT_SIZE_PT+"pt").text(function(a){return a.text})},updateAnimations:function(a){a.style("top",function(a){return this.__scales.ySpatial(a.rowPosition)-2+"px"}.bind(this)).style("left",function(a){return this.__scales.xSpatial(a.columnPosition)+this.CONST.EXPANSION_OFFSET+2.25*this.CONST.SPACING_PX+"px"}.bind(this));a.select("div.promoteButton").select("i").style("color",function(a){return a.isPromoted?this.CONST.HIGHLIGHT_COLOR:a.isDemoted?"#fff":null}.bind(this)).attr("class",function(a){return a.isPromoted?
this.CONST.ICONS.PROMOTIONS:this.CONST.ICONS.NO_PROMOTIONS}.bind(this));a.select("div.demoteButton").select("i").style("color",function(a){return a.isPromoted?"#fff":a.isDemoted?"#e7e7e7":null}.bind(this)).attr("class",function(a){return a.isDemoted?this.CONST.ICONS.DEMOTIONS:this.CONST.ICONS.NO_DEMOTIONS}.bind(this));a.select("div.rowText").style("color",function(a){return a.isPromoted?this.CONST.HIGHLIGHT_COLOR:a.isDemoted?"#dfdfdf":null}.bind(this)).style("font-weight",function(a){return a.isPromoted?
"bold":null}.bind(this)).style("text-decoration",function(a){return a.isDemoted?"line-through":null}.bind(this))},mouse:this.mouseListeners}})};MatrixView.prototype.__resetElements=function(){if(!0===this.__getDirtyModel())for(var a=0;a<this.__elements.length;a++){var b=this.__elements[a],c=b.identifier;b.layer.content.selectAll(c).remove();this.setDirty("elements",c)}};
MatrixView.prototype.__renderElements=function(){function a(a,b){a.attr("class",b).style("opacity",0)}function b(a){a.style("opacity",1)}function c(a){a.attr("class",null).style("opacity",0).remove()}for(var d=this.model.get("vis:schedules"),e=0;e<this.__elements.length;e++){var f=this.__elements[e],h=f.identifier,g=f.layer.content,k=f.renderers,l=d[f.dataID];if(l.isEnter){var m=h.substr(0,h.indexOf(".")),n=h.substr(h.indexOf(".")+1),p=this.model.get(f.dataID);g.selectAll(h).data(p).enter().append(m).call(a,
n)}g=g.selectAll(h);if(l.isEnter){var m=g.filter(function(a){return a.isEnter}),n=l.enter,q;for(q in k)m.call(k[q].bind(this));m=m.transition().duration(n.duration).delay(n.delay).ease(n.ease);m.call(b.bind(this));this.setDirty("elements",h,"enter",m.size())}l.isExit&&(m=g.filter(function(a){return a.isExit}),n=l.exit,m=m.transition().duration(n.duration).delay(n.delay).ease(n.ease),m.call(c.bind(this)),this.setDirty("elements",h,"exit",m.size()));if(l.isStay){var g=g.filter(function(a){return a.isStay}),
l=l.stay,n=m=!1,r;this.isDirty("scales")&&(m=!0);m||(f=f.dataID.replace(/^transition/,"all"),this.__isDirtyModel(f)&&(r=this.__getDirtyModel(f)),!0===r?m=!0:void 0!==r&&(n=!0));m?(k.hasOwnProperty("updateRenderer")&&g.call(k.updateRenderer.bind(this)),f=g.transition().duration(l.duration).delay(l.delay).ease(l.ease),f.call(b.bind(this)),k.hasOwnProperty("updateAnimations")&&f.call(k.updateAnimations.bind(this)),0<f.size()&&this.setDirty("elements",h,"stay",f.size())):n&&(k.hasOwnProperty("updateRenderer")&&
g.call(k.updateRenderer.bind(this)),f=g.filter(function(a){return r.hasOwnProperty(a.key)}).transition().duration(l.duration).delay(l.delay).ease(l.ease),f.call(b.bind(this)),k.hasOwnProperty("updateAnimations")&&f.call(k.updateAnimations.bind(this)),0<f.size()&&this.setDirty("elements",h,"dirty",f.size()))}}};
MatrixView.prototype.__resizeLayers=function(){if(this.isDirty("scales",["chartWidth","chartHeight"])){var a=this.model.get("vis:schedules").vis,b=a.pre,a=a.post,c=this.__scales.chartWidth,d=this.__scales.chartHeight,e=this.__scales.previousChartWidth,f=this.__scales.previousChartHeight,h=c>e||d>f,g;for(g in this.__layers){var k=this.__layers[g],l=k.dims.bind(this),m=l(c,d),l=l(e,f),n=k.renderer.bind(this);k.content.transition().duration(b.duration).delay(b.delay).ease(b.ease).call(n,h?m:l);k.content.transition().duration(a.duration).delay(a.delay).ease(a.ease).call(n,
m)}}};
MatrixView.prototype.__resizeContainerAndDepths=function(){if(this.isDirty("scales",["visWidth","visHeight"])){var a=this.model.get("vis:schedules").vis,b=a.pre,a=a.post,c=this.__container,d=this.__scales.visWidth,e=this.__scales.visHeight,f=c[0][0].offsetWidth-2,h=c[0][0].offsetHeight-2;c.transition().duration(b.duration).delay(b.delay).ease(b.ease).style("width",d>f?d+"px":f+"px").style("height",e>h?e+"px":h+"px");c.transition().duration(a.duration).delay(a.delay).ease(a.ease).style("width",d+"px").style("height",
e+"px");for(var g in this.__depths)c=this.__depths[g],c.transition().duration(b.duration).delay(b.delay).ease(b.ease).style("width",d>f?d+"px":f+"px").style("height",e>h?e+"px":h+"px"),c.transition().duration(a.duration).delay(a.delay).ease(a.ease).style("width",d+"px").style("height",e+"px")}};
MatrixView.prototype.__calculateChartWidthAndColumnLayouts=function(){this.__scales.previousChartWidth=this.__scales.chartWidth||0;if(this.__isDirtyModel("visibleColumnDims")||this.__isDirtyModel("expansionColumnPosition")){var a=this.model.get("visibleColumnDims"),b=this.CONST.SPACING_PX*a,c=d3.scale.linear().domain([0,a]).range([0,b]),d=this.model.get("expansionColumnPosition");if(void 0!==d)var b=b+this.CONST.EXPANSION_SPACING,e=c,f=d3.scale.linear().domain([0,a]).range([this.CONST.EXPANSION_SPACING,
b]),c=function(a){return a<d+0.5?e(a):a>d+0.5?f(a):e(d)+this.CONST.EXPANSION_OFFSET+this.CONST.SPACING_PX/2}.bind(this);this.__scales.columnDims=a;this.__scales.chartWidth=b;this.__scales.xSpatial=c;this.setDirty("scales",["columnDims","chartWidth","xSpatial"])}};
MatrixView.prototype.__calculateChartHeightAndRowLayouts=function(){this.__scales.previousChartHeight=this.__scales.chartHeight||0;if(this.__isDirtyModel("visibleRowDims")){var a=this.model.get("visibleRowDims"),b=this.CONST.SPACING_PX*a,c=d3.scale.linear().domain([0,a]).range([0,b]);this.__scales.rowDims=a;this.__scales.chartHeight=b;this.__scales.ySpatial=c;this.setDirty("scales",["rowDims","chartHeight","ySpatial"])}};
MatrixView.prototype.__calculateSizes=function(){if(this.__isDirtyModel("maxValue")){var a=this.model.get("maxValue"),a=d3.scale.sqrt().domain([0,a]).range([0,this.CONST.MAX_RADIUS_PX]);this.__scales.rSize=a;this.setDirty("scales","rSize")}this.__isDirtyModel("maxRowValue")&&(a=this.model.get("maxRowValue"),a=d3.scale.linear().domain([0,a]).range([0,this.CONST.FAR_BAR_MAX_LENGTH]),this.__scales.xLength=a,this.setDirty("scales","xLength"));this.__isDirtyModel("maxColumnValue")&&(a=this.model.get("maxColumnValue"),
a=d3.scale.linear().domain([0,a]).range([0,this.CONST.BOTTOM_BAR_MAX_LENGTH]),this.__scales.yLength=a,this.setDirty("scales","yLength"))};
MatrixView.prototype.__calculateDimensions=function(){if(this.isDirty("scales",["chartWidth","chartHeight"])){var a=this.CONST.OUTER_PADDING+this.CONST.TOP_PANEL_HEIGHT+this.CONST.TOP_PADDING+this.__scales.chartHeight+this.CONST.BOTTOM_PADDING+this.CONST.BOTTOM_PANEL_HEIGHT+this.CONST.OUTER_PADDING;this.__scales.visWidth=this.CONST.OUTER_PADDING+this.CONST.LEFT_PANEL_WIDTH+this.CONST.LEFT_PADDING+this.__scales.chartWidth+this.CONST.RIGHT_PADDING+this.CONST.RIGHT_PANEL_WIDTH+this.CONST.FAR_PADDING+
this.CONST.FAR_PANEL_WIDTH+this.CONST.OUTER_PADDING;this.__scales.visHeight=a;this.setDirty("scales",["visWidth","visHeight"])}};MatrixView.prototype.__getForegroundColor=function(a){var b=this.model.get("allSelectionGroups");return a.isSelected?b[a.selectionIndex].color:a.isHighlighted?void 0!==this.model.get("highlightSelectionIndex")?b[this.model.get("highlightSelectionIndex")].color:this.CONST.HIGHLIGHT_COLOR:this.CONST.DEFAULT_COLOR};
MatrixView.prototype.__getBackgroundColor=function(a){var b=this.model.get("allSelectionGroups");return a.isSelected?b[a.selectionIndex].background:a.isHighlighted?void 0!==this.model.get("highlightSelectionIndex")?b[this.model.get("highlightSelectionIndex")].background:this.CONST.HIGHLIGHT_BACKGROUND:this.CONST.DEFAULT_BACKGROUND};MatrixView.prototype.__getFontWeight=function(a){return a.isHighlighted?"bold":null};MatrixView.prototype.__getTextDecoration=function(a){return null};
MatrixView.prototype.__getCircleStrokeWidth=function(a){return a.isDemoted?0:a.isHighlighted?2.4:0.8};MatrixView.prototype.__getCircleStrokeOpacity=function(a){return a.isPromoted?1:a.isDemoted?0.3:1};MatrixView.prototype.__getCircleFillOpacity=function(a){return a.isPromoted?0.85:a.isDemoted?0.1:0.3};MatrixView.prototype.__getGridlineStrokeWidth=function(a){return a.isHighlighted?1.2:0.6};MatrixView.prototype.__getGridlineStrokeOpacity=function(a){return 1};
MatrixView.prototype.__getTotalStrokeOpacity=function(a){return 1};MatrixView.prototype.__getSubtotalStrokeOpacity=function(a){return a.isHighlighted?1:0.8};MatrixView.prototype.__topLabelAngle=MatrixView.prototype.CONST.TOP_LABEL_ANGLE_DEG;MatrixView.prototype.__topLabelWidth=MatrixView.prototype.CONST.TOP_PANEL_HEIGHT;MatrixView.prototype.__topLabelHeight=MatrixView.prototype.SPACING_PX;
MatrixView.prototype.__topLabelOffsetX=function(){var a=MatrixView.prototype.CONST.TOP_LABEL_ANGLE_DEG,b=Math.cos(a*Math.PI/180),a=Math.sin(a*Math.PI/180),c=0.5*MatrixView.prototype.CONST.TOP_PANEL_HEIGHT;return-c+(b*c-0.5*a*MatrixView.prototype.CONST.SPACING_PX+0*b-0.5*a*-MatrixView.prototype.CONST.SPACING_PX)}();
MatrixView.prototype.__topLabelOffsetY=function(){var a=MatrixView.prototype.CONST.TOP_LABEL_ANGLE_DEG,b=Math.cos(a*Math.PI/180),a=Math.sin(a*Math.PI/180),c=0.5*MatrixView.prototype.CONST.SPACING_PX;return-c+(0.5*a*MatrixView.prototype.CONST.TOP_PANEL_HEIGHT+b*c+0*a+0.5*b*-MatrixView.prototype.CONST.SPACING_PX)}();"undefined"!==typeof module&&(module.exports=MatrixView);
